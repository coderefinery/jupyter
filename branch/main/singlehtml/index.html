

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jupyter notebooks documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_lesson.css" />
      <link rel="stylesheet" type="text/css" href="_static/term_role_formatting.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_rtd_theme_ext_color_contrast.css" />
      <link rel="stylesheet" type="text/css" href="_static/tabs.css" />

  
    <link rel="shortcut icon" href="_static/coderefinery.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js"></script>
      <script src="_static/doctools.js"></script>
      <script src="_static/sphinx_highlight.js"></script>
      <script src="_static/clipboard.min.js"></script>
      <script src="_static/copybutton.js"></script>
      <script src="_static/minipres.js"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="_static/togglebutton.js"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="_static/tabs.js"></script>
      <script data-domain="coderefinery.github.io" defer="defer" src="https://plausible.cs.aalto.fi/js/script.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            Jupyter notebooks
          </a>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Core episodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-motivation">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-interface">JupyterLab and notebook interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-first-notebook">A first computational notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-version-control">Notebooks and version control</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-sharing">Sharing notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-summary">Summary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Optional episodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-extra-features">Shell commands, magics and widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-examples">Examples of Jupyter features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://youtu.be/xbTTDLA3txI">Shell crash course</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-exercises">List of exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-guide">Instructor guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-license">Credit and license</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/lessons/core/">All lessons</a></li>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/">CodeRefinery</a></li>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/lessons/reusing/">Reusing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Jupyter notebooks</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Jupyter notebooks  documentation</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/coderefinery/jupyter/blob/main/content/index" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="jupyter-notebooks-a-tool-to-write-and-share-executable-notebooks-and-data-visualization">
<h1>Jupyter notebooks - A tool to write and share executable notebooks and data visualization<a class="headerlink" href="#jupyter-notebooks-a-tool-to-write-and-share-executable-notebooks-and-data-visualization" title="Link to this heading"></a></h1>
<p>The goal of this lesson is to teach learners the user interface of JupyterLab,
how Jupyter notebooks work, and what some common and powerful use cases are.</p>
<p>For many learners, notebooks are not a new concept,
and our goal will be to demonstrate and discuss and guide towards good practices
for <strong>reproducibility, collaboration, and reusability</strong>.</p>
<div class="admonition-prerequisites prerequisites admonition" id="prerequisites-0">
<p class="admonition-title">Prerequisites</p>
<ul class="simple">
<li><p>A reasonably recent version of Jupyter and JupyterLab, which is installed
as part of the
<a class="reference external" href="https://coderefinery.github.io/installation/conda-environment/">Conda environment for CodeRefinery workshops</a>.</p></li>
<li><p>Optional (we only demonstrate this):
A reasonably recent version of Git to be able to work with the JupyterLab Git integration.</p></li>
<li><p>If you wish to follow in the terminal and are new to the command line, we
recorded a <a class="reference external" href="https://youtu.be/xbTTDLA3txI">short shell crash course</a>.</p></li>
</ul>
</div>
<div class="toctree-wrapper compound">
<span id="document-motivation"></span><section id="jupyter-notebooks">
<h2>Jupyter Notebooks<a class="headerlink" href="#jupyter-notebooks" title="Link to this heading"></a></h2>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Get an idea of the purpose of Jupyter.</p></li>
<li><p>See some inspirational Jupyter Notebooks.</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>10 min teaching</p></li>
<li><p>0 min exercises</p></li>
</ul>
</div>
<section id="motivation-for-jupyter-notebooks">
<h3>Motivation for Jupyter Notebooks<a class="headerlink" href="#motivation-for-jupyter-notebooks" title="Link to this heading"></a></h3>
<p>Jupyter Notebook is a tool for creating and sharing documents that contain live code, equations, visualizations, and narrative text.</p>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="_images/‎Jupyter_Pandas_demo.png"><img alt="A comparison between pure Python code and a Jupyter Notebook highlights how Jupyter Notebook can include much more elaborate narrative than regular code files." src="_images/%E2%80%8EJupyter_Pandas_demo.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">Jupyter Notebooks can contain much more than just regular code. (CC-BY).</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p><strong>Code, text, equations, figures, plots</strong>, etc. are interleaved, creating a <em>computational narrative</em>.</p></li>
<li><p><a class="reference external" href="https://www.nature.com/articles/d41586-018-07196-1"><em>“an environment in which users execute code, see what happens, modify and
repeat in a kind of iterative conversation between researcher and
data”</em></a></p></li>
<li><p>The name “Jupyter” derives from Julia+Python+R, but today Jupyter kernels
exist for <a class="reference external" href="https://github.com/jupyter/jupyter/wiki/Jupyter-kernels">dozens of programming languages</a>.</p></li>
</ul>
<section id="jupyter-notebook-ish-functionalities-are-widely-used">
<h4>Jupyter Notebook-ish functionalities are widely used<a class="headerlink" href="#jupyter-notebook-ish-functionalities-are-widely-used" title="Link to this heading"></a></h4>
<p>Many tools can have Jupyter-like behaviour: code and markdown cells</p>
<ul class="simple">
<li><p>VSCode</p></li>
<li><p>Google Colab</p></li>
<li><p>GitHub Codespaces</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="case-examples">
<h3>Case examples<a class="headerlink" href="#case-examples" title="Link to this heading"></a></h3>
<p>Jupyter Notebooks make it feasible to share your code: you can explain your
ideas and anyone can run the code eg. in <a class="reference external" href="https://mybinder.org/">Binder</a>.</p>
<section id="gravitational-wave-discovery">
<h4><a class="reference external" href="https://www.gw-openscience.org/about/">Gravitational wave discovery</a><a class="headerlink" href="#gravitational-wave-discovery" title="Link to this heading"></a></h4>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="_images/gravity.jpg"><img alt="Discovery of gravitational waves" src="_images/gravity.jpg" style="width: 50%;" />
</a>
<figcaption>
<p><span class="caption-text">Discovery of gravitational waves.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>As a case example, let us have a look at the analysis published together with the
discovery of gravitational waves. <a class="reference external" href="https://losc.ligo.org/tutorials/">This
page</a> lists the available analyses
and presents several options to browse them.</p>
<ul class="simple">
<li><p>A quick look at short segments of data can be found at
<a class="reference external" href="https://github.com/losc-tutorial/quickview">https://github.com/losc-tutorial/quickview</a></p></li>
<li><p>The notebook can be opened and interactively explored
using Binder by clicking the “launch Binder” button.</p></li>
<li><p>How does the Binder instance know which Python packages to load? It takes the information
from files like <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> (Python) or <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">runtime.txt</span></code> (R).</p></li>
</ul>
</section>
<section id="activity-inequality-study">
<h4><a class="reference external" href="http://activityinequality.stanford.edu/">Activity inequality</a> study<a class="headerlink" href="#activity-inequality-study" title="Link to this heading"></a></h4>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="_images/activity_inequality.png"><img alt="Stanford Activity Inequality Study" src="_images/activity_inequality.png" style="width: 80%;" />
</a>
<figcaption>
<p><span class="caption-text">Stanford Activity Inequality Study.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Researchers in the Stanford Activity Inequality Study measured daily
activity from cell phone tracking data for over 700,000 users in
different countries across the world.</p>
<ul class="simple">
<li><p>All data and notebooks are available at
<a class="reference external" href="https://github.com/timalthoff/activityinequality">https://github.com/timalthoff/activityinequality</a></p></li>
<li><p>Even without a “launch binder” button, the notebooks can still be
<a class="reference external" href="https://mybinder.org/v2/gh/timalthoff/activityinequality/master">launched on Binder</a>
(you may see an error “missing R kernel” because a file <code class="docutils literal notranslate"><span class="pre">runtime.txt</span></code> is missing - more about that later)</p></li>
<li><p>Do you see any potential problems in recreating e.g.
<a class="reference external" href="https://github.com/timalthoff/activityinequality/blob/master/fig3/fig3bc.ipynb">fig3bc</a>?</p></li>
</ul>
</section>
<section id="more-examples">
<h4>More examples<a class="headerlink" href="#more-examples" title="Link to this heading"></a></h4>
<p>For further inspiration, head over to the
<a class="reference external" href="https://github.com/jupyter/jupyter/wiki">Gallery of interesting Jupyter Notebooks</a>.</p>
</section>
</section>
<hr class="docutils" />
<section id="use-cases">
<h3>Use cases<a class="headerlink" href="#use-cases" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Really good for <strong>linear workflows</strong> (e.g. read data, filter data, do some statistics, plot the results)</p></li>
<li><p>Experimenting with new ideas, testing new libraries/databases</p></li>
<li><p>As an <em>interactive</em> development environment for code, data analysis, and visualization</p></li>
<li><p>Interactive work on HPC clusters</p></li>
<li><p>Sharing and explaining code to colleagues</p></li>
<li><p>Teaching (programming, experimental/theoretical science)</p></li>
<li><p>Learning from other notebooks</p></li>
<li><p>Keeping track of interactive sessions, like a <strong>digital lab notebook</strong></p></li>
<li><p><strong>Supplementary information with published articles</strong></p></li>
<li><p>Slide presentations using <a class="reference external" href="https://github.com/damianavila/RISE">Reveal.js</a></p></li>
</ul>
</section>
<section id="pitfalls">
<h3>Pitfalls<a class="headerlink" href="#pitfalls" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Programs with non-linear code flow</p></li>
<li><p>Large codebase (however it can make sense to use Jupyter as interface to the large codebase and import the codebase as a module)</p></li>
<li><p>You cannot easily write a notebook directly in your text editor (but you can do
that with <a class="reference external" href="https://rmarkdown.rstudio.com/">R Markdown</a>)</p></li>
<li><p>Notebooks can be <strong>version controlled</strong>
(<a class="reference external" href="https://nbdime.readthedocs.io/">nbdime</a> helps with that), but
there are <strong>still limitations</strong>.</p></li>
<li><p>Notebooks <strong>aren’t named by default</strong> and tend to <strong>acquire a bunch of
unrelated stuff</strong>.  Be careful with organization!</p></li>
<li><p>See also <a class="reference external" href="https://scicomp.aalto.fi/scicomp/jupyter-pitfalls/">https://scicomp.aalto.fi/scicomp/jupyter-pitfalls/</a>.</p></li>
</ul>
</section>
<section id="good-practices">
<h3>Good practices<a class="headerlink" href="#good-practices" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Rename notebooks from “Untitled.ipynb”.</p></li>
<li><p>Run all cells before sharing/saving to verify that the results you see on your
computer were not due to cells being run out of order (we will try this later).</p></li>
</ul>
</section>
</section>
<span id="document-interface"></span><section id="jupyterlab-and-notebook-interface">
<h2>JupyterLab and notebook interface<a class="headerlink" href="#jupyterlab-and-notebook-interface" title="Link to this heading"></a></h2>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn to navigate JupyterLab user interface.</p></li>
<li><p>Discuss integrated development environments.</p></li>
<li><p>Get an overview of useful keyboard shortcuts.</p></li>
<li><p>Learn about command/edit modes and markdown/code cells.</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>15 min teaching</p></li>
<li><p>0 min exercises</p></li>
</ul>
</div>
<p>JupyterLab is the next-generation user interface for Jupyter Notebooks
and is intended to replace the conventional interface.
It is a highly modular and customizable interface.</p>
<hr class="docutils" />
<section id="how-to-start-jupyterlab">
<h3>How to start JupyterLab<a class="headerlink" href="#how-to-start-jupyterlab" title="Link to this heading"></a></h3>
<p>Let’s have a look at how it works. We go to terminal, and type:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mkdir<span class="w"> </span>jupyterlab-demo
<span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>jupyterlab-demo
<span class="gp">$ </span>jupyter-lab
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="components-the-big-picture">
<h3>Components: the big picture<a class="headerlink" href="#components-the-big-picture" title="Link to this heading"></a></h3>
<figure class="align-default" id="id1">
<img alt="Components of a Jupyter notebook" src="_images/notebook_components.png" />
<figcaption>
<p><span class="caption-text">Components of a Jupyter notebook.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="navigation">
<h3>Navigation<a class="headerlink" href="#navigation" title="Link to this heading"></a></h3>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="_images/JupyterInterface.png"><img alt="Jupyter used interface has a file browser and a notebook view" src="_images/JupyterInterface.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">Jupyter Lab user interface has a left side toolbar – that has a file browser and a git tab. The file browser shows the file that Jupyter Lab was opened in. The right side shows the files that are open. You can have split view by dragging from the top tab view. (CC-BY)</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Left-hand menu (toggle it with <code class="docutils literal notranslate"><span class="pre">Ctrl(⌘)-b</span></code>):</p>
<ul>
<li><p>File browser</p>
<ul>
<li><p>New launcher</p></li>
<li><p>New folder</p></li>
<li><p>Upload files</p></li>
</ul>
</li>
<li><p>Running terminals and kernels</p></li>
<li><p>Command palette</p></li>
<li><p>Cell inspector</p></li>
<li><p>Open tabs</p></li>
<li><p>Git integration (if <code class="docutils literal notranslate"><span class="pre">jupyterlab-git</span></code> extension installed)</p></li>
<li><p>GitHub browser (if <code class="docutils literal notranslate"><span class="pre">jupyterlab-github</span></code> extension installed)</p></li>
</ul>
</li>
<li><p>Fully-fledged terminal</p></li>
<li><p>Text editor for source code in different languages</p></li>
<li><p>Code console to run code interactively in a kernel with rich output and linear order</p></li>
<li><p>Modular interface</p>
<ul>
<li><p>Notebooks, terminals, consoles, data files etc can be moved around</p></li>
</ul>
</li>
<li><p>Classical notebook style is available under the Help menu</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="cells">
<h3>Cells<a class="headerlink" href="#cells" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Markdown cells</strong> contain formatted text written in Markdown</p></li>
<li><p><strong>Code cells</strong> contain code to be interpreted by the <em>kernel</em> (Python, R, Julia, Octave/Matlab…)</p></li>
</ul>
<section id="markdown-cells">
<h4>Markdown cells<a class="headerlink" href="#markdown-cells" title="Link to this heading"></a></h4>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gu">## Second level heading</span>

This cell contains simple
[<span class="nt">markdown</span>](<span class="na">https://daringfireball.net/projects/markdown/syntax</span>), a simple language for writing text that can be automatically converted to other formats, e.g. HTML, LaTeX or any of a number of others.

<span class="gs">**Bold**</span>, <span class="ge">*italics*</span>, <span class="gs">**_combined_**</span>, <span class="gd">~~strikethrough~~</span>, <span class="sb">`inline code`</span>.

<span class="k">*</span><span class="w"> </span>bullet points

or

<span class="k">1.</span> numbered
<span class="k">3.</span> lists

<span class="gs">**Equations:**</span>
inline $e^{i\pi} + 1 = 0$
or on new line
$$e^{i\pi} + 1 = 0$$

Images:

![<span class="nt">Jupyter logo</span>](<span class="na">https://jupyter.org/assets/homepage/main-logo.svg</span>)

Links:
[<span class="nt">One of many markdown cheat-sheets</span>](<span class="na">https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet#emphasis</span>)
</pre></div>
</div>
</section>
<section id="code-cells">
<h4>Code cells<a class="headerlink" href="#code-cells" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># a code cell can run statements of code.</span>
<span class="c1"># when you run this cell, the output is sent</span>
<span class="c1"># from the web page to a back-end process, run</span>
<span class="c1"># and the results are displayed to you</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="command-and-edit-modes">
<h4>Command and edit modes<a class="headerlink" href="#command-and-edit-modes" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>To add contents to a cell, you need to enter <em>edit mode</em> by pressing <code class="docutils literal notranslate"><span class="pre">Enter</span></code> or
double-clicking on a cell</p></li>
<li><p>To navigate between cells, create new cells, etc., you need to enter <em>command</em> mode by
pressing <code class="docutils literal notranslate"><span class="pre">Escape</span></code> key or executing the current cell.</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="keyboard-shortcuts">
<h3>Keyboard shortcuts<a class="headerlink" href="#keyboard-shortcuts" title="Link to this heading"></a></h3>
<p>Some shortcuts only work in Command or Edit mode.
It can also happen that these shortcuts interfere with browser shortcuts.</p>
<section id="cell-shortcuts">
<h4>Cell shortcuts<a class="headerlink" href="#cell-shortcuts" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Shortcut</p></th>
<th class="head"><p>Effect</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Enter</span></code></p></td>
<td><p>Enter Edit mode</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Escape</span></code> or <code class="docutils literal notranslate"><span class="pre">Ctrl</span></code>-<code class="docutils literal notranslate"><span class="pre">m</span></code></p></td>
<td><p>Enter Command mode</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl</span></code>-<code class="docutils literal notranslate"><span class="pre">Enter</span></code></p></td>
<td><p>Run the cell</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Shift</span></code>-<code class="docutils literal notranslate"><span class="pre">Enter</span></code></p></td>
<td><p>Run the cell and select the cell below</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Alt</span></code>-<code class="docutils literal notranslate"><span class="pre">Enter</span></code></p></td>
<td><p>Run the cell and insert a new cell below</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code></p></td>
<td><p>Toggle between Markdown and Code cells</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">d-d</span></code></p></td>
<td><p>Delete a cell</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">z</span></code></p></td>
<td><p>Undo deleting</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a/b</span></code></p></td>
<td><p>Insert cells above/below current cell</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">x/c/v</span></code></p></td>
<td><p>Cut/copy/paste cells</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Up/Down</span></code> or <code class="docutils literal notranslate"><span class="pre">k/j</span></code></p></td>
<td><p>Select previous/next cells</p></td>
</tr>
</tbody>
</table>
</section>
<section id="notebook-shortcuts">
<h4>Notebook shortcuts<a class="headerlink" href="#notebook-shortcuts" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Shortcut</p></th>
<th class="head"><p>Effect</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl(⌘)</span></code>-<code class="docutils literal notranslate"><span class="pre">s</span></code></p></td>
<td><p>Save notebook</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Shift</span></code>-<code class="docutils literal notranslate"><span class="pre">Ctrl(⌘)</span></code>-<code class="docutils literal notranslate"><span class="pre">s</span></code></p></td>
<td><p>Save notebook as</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl</span></code>-q</p></td>
<td><p>Close notebook</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl(⌘)</span></code>-<code class="docutils literal notranslate"><span class="pre">b</span></code></p></td>
<td><p>Toggle left-hand menu</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Shift</span></code>-<code class="docutils literal notranslate"><span class="pre">Ctrl(⌘)</span></code>-<code class="docutils literal notranslate"><span class="pre">c</span></code></p></td>
<td><p>Open command palette</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Shift</span></code>-<code class="docutils literal notranslate"><span class="pre">Ctrl(⌘)</span></code>-d</p></td>
<td><p>Toggle single-document mode</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="tools-for-writing-testing-and-debugging-code">
<span id="integrated-development-environments"></span><h4>Tools for writing, testing and debugging code<a class="headerlink" href="#tools-for-writing-testing-and-debugging-code" title="Link to this heading"></a></h4>
<div class="admonition-what-tools-do-you-use-for-writing-testing-and-debugging-code admonition">
<p class="admonition-title">What tools do you use for writing, testing, and debugging code?</p>
<p>Some people prefer <strong>terminal-based text editors</strong> for writing code (e.g. Vi/Vim, Nano, Emacs, etc.).</p>
<p>Others prefer <strong>integrated development environments (IDEs)</strong>,
which can bring “everything” one needs for productive programming to one’s fingertips.a</p>
<p>Yet others prefer <strong>code editors</strong>, which are light-weight IDEs.</p>
<p><strong>Terminal editor</strong></p>
<ul class="simple">
<li><p>Good command line skills are needed for effectively using terminal editors</p></li>
<li><p>Continue using Emacs and Vim, if you are already proficient</p></li>
<li><p>Supports multiple programming languages</p></li>
</ul>
<p><strong>IDE</strong></p>
<ul class="simple">
<li><p>If you are working with large code bases, then you should definitely checkout the IDE suitable for your programming language</p></li>
<li><p>IDEs offer rich support for Debugging and Code refactoring</p></li>
<li><p>Focused on a single language</p></li>
</ul>
<p><strong>Code editor</strong></p>
<ul class="simple">
<li><p>If you use multiple programming languages then code editors offer good support</p></li>
<li><p>Both IDE and code editors share common features such as code completion, hints, highlighting sections of code</p></li>
<li><p>Supports multiple programming languages</p></li>
</ul>
</div>
</section>
</section>
</section>
<span id="document-first-notebook"></span><section id="a-first-computational-notebook">
<h2>A first computational notebook<a class="headerlink" href="#a-first-computational-notebook" title="Link to this heading"></a></h2>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Get started with notebooks for analysis.</p></li>
<li><p>Get a feeling for the importance of execution order.</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>5 min teaching</p></li>
<li><p>20 min exercises</p></li>
</ul>
</div>
<section id="creating-a-computational-narrative">
<h3>Creating a computational narrative<a class="headerlink" href="#creating-a-computational-narrative" title="Link to this heading"></a></h3>
<p>Let’s create our first real computational narrative in a Jupyter notebook
(adapted from <a class="reference external" href="https://github.com/AaltoScienceIT/python-r-data-analysis-course">Python and R data analysis course</a> at Aalto Science IT).</p>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="_images/pi_with_darts.png"><img alt="Picture of throwing darts" src="_images/pi_with_darts.png" style="width: 30%;" />
</a>
<figcaption>
<p><span class="caption-text">Throwing darts to compute pi.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Imagine you are on a desert island and wish to compute pi.
You have a computer with you with Python installed but no
math libraries and no Wikipedia.</p>
<p>Here is one way of doing it - “throwing darts” by generating
random points within a square area and checking whether the points
fall within the unit circle.</p>
</section>
<hr class="docutils" />
<section id="launching-jupyterlab-notebook">
<h3>Launching JupyterLab notebook<a class="headerlink" href="#launching-jupyterlab-notebook" title="Link to this heading"></a></h3>
<p>In your terminal <strong>first create a folder or navigate to a folder</strong> where you would like
the new notebook to appear.</p>
<p><strong>After you have created a new folder and moved to it</strong>, launch JupyterLab:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>jupyter-lab
</pre></div>
</div>
<p>This opens JupyterLab in your browser. Click on the Python 3 tile.</p>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="_images/launching-python.png"><img alt="JupyterLab opened in the browser" src="_images/launching-python.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">JupyterLab opened in the browser. Click on the Python 3 tile.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>If you prefer to select in which browser to open JupyterLab, use:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>jupyter-lab<span class="w"> </span>--no-browser
</pre></div>
</div>
<hr class="docutils" />
</section>
<section id="an-example-computational-notebook">
<span id="first-notebook"></span><h3>An example computational notebook<a class="headerlink" href="#an-example-computational-notebook" title="Link to this heading"></a></h3>
<div class="admonition-hint-opening-a-webpage-inside-jupyterlab discussion important admonition" id="discussion-0">
<p class="admonition-title">Hint: Opening a webpage inside JupyterLab</p>
<p>If you would like to copy-paste content from this webpage into your
Jupyter notebook, a cool way of doing it is to open this page inside
an IFrame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">IFrame</span>
<span class="n">IFrame</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s2">&quot;https://coderefinery.github.io/jupyter/first-notebook/&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s1">&#39;100%&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s1">&#39;500px&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-exercise-demonstration-calculating-pi-using-monte-carlo-methods exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise/demonstration: Calculating pi using Monte Carlo methods</p>
<p>This can be either done as a 20 minute exercise or as a type-along demo.</p>
<p>Each numbered item will be a new cell. Press SHIFT+ENTER to run a cell and create
a new cell below. With the cell selected, press ESCAPE to go into command mode. Use shortcuts <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code> to change cells to markdown and code, respectively.</p>
<ol class="arabic">
<li><p>Create a new notebook, name it, and add a heading (markdown cell).</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gh"># Calculating pi using Monte Carlo methods</span>
</pre></div>
</div>
</li>
<li><p>Document the relevant formulas in a new cell (markdown cell):</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gu">## Relevant formulas</span>

<span class="k">-</span><span class="w"> </span>square area: $s = (2 r)^2$
<span class="k">-</span><span class="w"> </span>circle area: $c = \pi r^2$
<span class="k">-</span><span class="w"> </span>$c/s = (\pi r^2) / (4 r^2) = \pi / 4$
<span class="k">-</span><span class="w"> </span>$\pi = 4 * c/s$
</pre></div>
</div>
</li>
<li><p>Add an image to explain the concept (markdown cell):</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gu">## Image to visualize the concept</span>

![<span class="nt">Darts</span>](<span class="na">https://raw.githubusercontent.com/coderefinery/jupyter/main/example/darts.svg</span>)
</pre></div>
</div>
</li>
<li><p>Import two modules that we will need (code cell):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># importing modules that we will need</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</pre></div>
</div>
</li>
<li><p>Initialize the number of points (code cell):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># initializing the number of &quot;throws&quot;</span>

<span class="n">num_points</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
</li>
<li><p>“Throw darts” (code cell):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># here we &quot;throw darts&quot; and count the number of hits</span>

<span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">hits</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>Plot results (code cell):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># unzip points into 3 lists</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">)</span>

<span class="c1"># define figure dimensions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span>

<span class="c1"># plot results</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Compute the estimate for pi (code cell):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute and print the estimate</span>

<span class="n">fraction</span> <span class="o">=</span> <span class="n">hits</span> <span class="o">/</span> <span class="n">num_points</span>
<span class="mi">4</span> <span class="o">*</span> <span class="n">fraction</span>
</pre></div>
</div>
</li>
</ol>
</div>
<p>Here is the notebook: <a class="reference external" href="https://github.com/coderefinery/jupyter/blob/main/example/darts.ipynb">https://github.com/coderefinery/jupyter/blob/main/example/darts.ipynb</a>
(static version, later we will learn how to share notebooks which are dynamic
and can be modified).</p>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-1">
<p class="admonition-title">Instructor note</p>
<p>Demonstrate out-of-order execution problems and how to avoid them:</p>
<ul class="simple">
<li><p>Add a cell at the end of the notebook which redefines <code class="docutils literal notranslate"><span class="pre">num_points</span></code></p></li>
<li><p>Then run the cell which computes the pi estimate</p></li>
<li><p>Then demonstrate “run all cells”</p></li>
</ul>
</div>
<hr class="docutils" />
</section>
<section id="notebooks-in-other-languages">
<span id="other-kernels"></span><h3>Notebooks in other languages<a class="headerlink" href="#notebooks-in-other-languages" title="Link to this heading"></a></h3>
<p>It is possible to use Jupyter for other programming languages than Python
(<a class="reference external" href="https://github.com/jupyter/jupyter/wiki/Jupyter-kernels">list of supported
kernels</a>).  However,
if you write R or Julia code, instead of installing a kernel, we recommend to
use their corresponding notebook solutions which are optimized for these
languages:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://rmarkdown.rstudio.com/">R Markdown</a> for R</p></li>
<li><p><a class="reference external" href="https://plutojl.org/">Pluto.jl</a> for Julia</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="discussion">
<h3>Discussion<a class="headerlink" href="#discussion" title="Link to this heading"></a></h3>
<p>What do we get from this?</p>
<ul class="simple">
<li><p>With code separate from everything else, you might just send one
number or a plot to your supervisor/collaborator for checking.</p></li>
<li><p>With a notebook as a narratives, you send everything in a <strong>consistent
story</strong>.</p></li>
<li><p>A reader may still just read the introduction and conclusion, but
they can easily see more - <em>and try changes themselves</em> - if they
want.</p></li>
</ul>
<div class="admonition-where-should-we-add-comments discussion important admonition" id="discussion-1">
<p class="admonition-title">Where should we add comments?</p>
<p>We can comment code either in <strong>Markdown cells</strong> or in the code cell as <strong>code comments</strong>.</p>
<p>What advantages do you see of commenting in Markdown cells and what advantages
can you list for writing code comments in code cells?</p>
</div>
<hr class="docutils" />
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Notebooks provide an intuitive way to perform interactive computational work.</p></li>
<li><p>Allows fast feedback in your test-code-refactor loop.</p></li>
<li><p>Cells can be executed in any order, beware of out-of-order execution bugs!</p></li>
</ul>
</div>
</section>
</section>
<span id="document-version-control"></span><section id="notebooks-and-version-control">
<h2>Notebooks and version control<a class="headerlink" href="#notebooks-and-version-control" title="Link to this heading"></a></h2>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Demonstrate two tools which make version control of notebooks easier.</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>10 min teaching</p></li>
<li><p>5 min demo</p></li>
</ul>
</div>
<p>Jupyter Notebooks are stored in <a class="reference external" href="https://en.wikipedia.org/wiki/JSON">JSON</a> format.
With this format it can be a bit difficult to compare and merge changes which are introduced
through the notebook interface.</p>
<section id="packages-and-jupyterlab-extensions-to-simplify-version-control">
<h3>Packages and JupyterLab extensions to simplify version control<a class="headerlink" href="#packages-and-jupyterlab-extensions-to-simplify-version-control" title="Link to this heading"></a></h3>
<p>Several packages and JupyterLab extensions have been developed
to make it easier to interact with Git and GitHub:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://nbdime.readthedocs.io/">nbdime</a> (notebook “diff” and “merge”) provides
“content-aware” diffing and merging.</p>
<ul>
<li><p>Adds a Git button to the notebook interface.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">merge</span></code> shell commands can use nbdime’s diff
and merge for notebook files, but leave Git’s behavior unchanged
for non-notebook files.</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://github.com/jupyterlab/jupyterlab-git">jupyterlab-git</a>
is a JupyterLab extension for version control using Git.</p>
<ul>
<li><p>Adds a Git tab to the left-side menu bar for version control inside JupyterLab.</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://www.npmjs.com/package/&#64;jupyterlab/github">JupyterLab GitHub</a>
is a JupyterLab extension for accessing GitHub repositories.</p>
<ul>
<li><p>Adds a GitHub tab to the left-side menu bar where you can browse
and open notebooks from your GitHub repositories.</p></li>
</ul>
</li>
</ul>
<p>All three extensions can be used from within the JupyterLab interface and our
<a class="reference external" href="https://coderefinery.github.io/installation/conda-environment/">Conda
environment</a>
provides <a class="reference external" href="https://github.com/jupyterlab/jupyterlab-git">jupyterlab-git</a> and
<a class="reference external" href="http://nbdime.readthedocs.io/">nbdime</a>.  To install additional extensions,
please consult the <a class="reference external" href="https://jupyterlab.readthedocs.io/en/stable/user/extensions.html">official
documentation</a>
about installing and managing JupyterLab extensions.</p>
</section>
<hr class="docutils" />
<section id="comparing-jupyter-notebooks-on-github">
<h3>Comparing Jupyter Notebooks on GitHub<a class="headerlink" href="#comparing-jupyter-notebooks-on-github" title="Link to this heading"></a></h3>
<p>For this you really want to enable <a class="reference external" href="https://docs.github.com/en/repositories/working-with-files/using-files/working-with-non-code-files#working-with-jupyter-notebook-files-on-github">Rich Jupyter Notebook
Diffs</a>
on GitHub:</p>
<ul class="simple">
<li><p>On GitHub click on your avatar/image (top right).</p></li>
<li><p>Click on “Feature preview”.</p></li>
<li><p>Enable “Rich Jupyter Notebook Diffs”.</p></li>
</ul>
<p>To demonstrate the difference we have created a small change and you can try to
compare the effect yourself by enabling/disabling the feature:
<a class="reference external" href="https://github.com/coderefinery/jupyter/compare/5ff55b8..fce21e6">https://github.com/coderefinery/jupyter/compare/5ff55b8..fce21e6</a></p>
<p>Here is the diff <strong>without “Rich Jupyter Notebook Diffs”</strong>:</p>
<figure class="align-default" id="id1">
<a class="with-border reference internal image-reference" href="_images/github-without-rich-diff.png"><img alt="A small change but without &quot;Rich Jupyter Notebook Diffs&quot;" class="with-border" src="_images/github-without-rich-diff.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">A small change in a notebook viewed on GitHub
without “Rich Jupyter Notebook Diffs” (truncated).</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Here is the same change, but this time <strong>with “Rich Jupyter Notebook Diffs” enabled</strong>:</p>
<figure class="align-default" id="id2">
<a class="with-border reference internal image-reference" href="_images/github-with-rich-diff.png"><img alt="A small change in a notebook viewed on GitHub with &quot;Rich Jupyter Notebook Diffs&quot; enabled" class="with-border" src="_images/github-with-rich-diff.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">The same change viewed on GitHub, this time
with “Rich Jupyter Notebook Diffs” enabled.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="comparing-changes-locally-without-jupyterlab-git-nbdime">
<h3>Comparing changes locally without jupyterlab-git/nbdime<a class="headerlink" href="#comparing-changes-locally-without-jupyterlab-git-nbdime" title="Link to this heading"></a></h3>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-1">
<span id="plain-git-diff"></span><p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>Create a new folder</p></li>
<li><p>Initialize a new Git repository (which is anyway good to demonstrate)</p></li>
<li><p>Copy the “darts” notebook into it (from the previous episode)</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">.ipynb_checkpoints/</span></code> to <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code></p></li>
<li><p>Stage and commit the file before trying the changes below</p></li>
</ul>
</div>
<div class="admonition-instructor-demonstrates-a-plain-git-diff exercise important admonition" id="exercise-0">
<p class="admonition-title">Instructor demonstrates a plain git diff</p>
<ol class="arabic simple">
<li><p>To understand the problem, the instructor first shows the <a class="reference external" href="https://github.com/coderefinery/jupyter/blob/main/example/darts.ipynb">example
notebook</a>
and then the <a class="reference external" href="https://raw.githubusercontent.com/coderefinery/jupyter/main/example/darts.ipynb">source
code</a>
in JSON format.</p></li>
<li><p>Then we introduce a simple change to the example notebook, for instance
changing colors (change “red” and “blue” to something else)
and also changing dimensions in <code class="docutils literal notranslate"><span class="pre">fig.set_size_inches(6.0,</span> <span class="pre">6.0)</span></code>.</p></li>
<li><p>Run all cells.</p></li>
<li><p>We save the change (save icon) and in the JupyterLab terminal try a “normal” <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code>
and see that this is not very useful. Discuss why.</p></li>
</ol>
</div>
</section>
<hr class="docutils" />
<section id="comparing-changes-with-jupyterlab-git-nbdime">
<h3>Comparing changes with jupyterlab-git/nbdime<a class="headerlink" href="#comparing-changes-with-jupyterlab-git-nbdime" title="Link to this heading"></a></h3>
<p>Let us inspect the same changes using jupyterlab-git (which uses nbdime).
This is more convenient since it highlights only the changes that we have made:</p>
<figure class="align-default" id="id3">
<img alt="Comparing changes with jupyterlab-git/nbdime" src="_images/git.jpg" />
<figcaption>
<p><span class="caption-text">Comparing changes with jupyterlab-git/nbdime. Click on the Git tab, then on the plus-minus symbol.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="using-nbdime-on-the-command-line">
<h3>Using nbdime on the command line<a class="headerlink" href="#using-nbdime-on-the-command-line" title="Link to this heading"></a></h3>
<p>You can configure your (command line) Git to always use nbdime when comparing and merging notebooks:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>nbdime<span class="w"> </span>config-git<span class="w"> </span>--enable<span class="w"> </span>--global
</pre></div>
</div>
<p>Now when you do git diff or git merge with notebooks, you should see a nice diff view.
For more information please see the
<a class="reference external" href="https://nbdime.readthedocs.io/en/latest/#git-integration-quickstart">corresponding documentation</a>.</p>
</section>
<hr class="docutils" />
<section id="see-also">
<h3>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://nbdev.fast.ai/getting_started.html">nbdev</a> developed by <a class="reference external" href="https://www.fast.ai/">fast.ai</a>
is a notebook-driven development platform which includes support for <a class="reference external" href="https://nbdev.fast.ai/tutorials/git_friendly_jupyter.html">git-friendly Jupyter
notebooks</a></p></li>
<li><p><a class="reference external" href="https://github.com/mkery/Verdant/">Verdant</a> is a JupyterLab extension that automatically
records history of all experiments you run in a Jupyter notebook, and stores them in an
<code class="docutils literal notranslate"><span class="pre">.ipyhistory</span></code> JSON file.</p></li>
</ul>
</section>
</section>
<span id="document-sharing"></span><section id="sharing-notebooks">
<h2>Sharing notebooks<a class="headerlink" href="#sharing-notebooks" title="Link to this heading"></a></h2>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn how to share notebooks with colleagues and the community?</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>5 min teaching</p></li>
<li><p>20 min exercises</p></li>
</ul>
</div>
<div class="admonition-nudge-your-brain-when-have-you-shared-your-code discussion important admonition" id="discussion-0">
<p class="admonition-title">Nudge your brain: When have you shared your code?</p>
<ul class="simple">
<li><p>To yourself between two computers?</p></li>
<li><p>To a large audience eg. on a webpage?</p></li>
<li><p>Coding together with a colleague?</p></li>
</ul>
</div>
<hr class="docutils" />
<section id="different-ways-to-share-a-notebook">
<h3>Different ways to share a notebook<a class="headerlink" href="#different-ways-to-share-a-notebook" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>You can enter a URL, GitHub repo or username, or GIST ID in <a class="reference external" href="https://nbviewer.jupyter.org/">nbviewer</a> and view a rendered Jupyter notebook</p></li>
<li><p>Read the Docs can render Jupyter Notebooks via the <a class="reference external" href="https://nbsphinx.readthedocs.io/">nbsphinx package</a></p></li>
<li><p><a class="reference external" href="https://mybinder.org/">Binder</a> creates live notebooks based on a GitHub repository</p></li>
<li><p><a class="reference external" href="https://notebooks.egi.eu">EGI Notebooks</a> (see also https://egi-notebooks.readthedocs.io)</p></li>
<li><p><a class="reference external" href="https://github.com/jupyterlab/jupyterlab">JupyterLab</a> supports sharing and collaborative editing of notebooks via Google Drive. Recently
it also added support for <a class="reference external" href="https://github.com/jupyterlab/jupyterlab/pull/10118">Shared editing with collaborative notebook model</a>.</p></li>
<li><p><a class="reference external" href="https://jupyterlite.readthedocs.io/en/latest/">JupyterLite</a> creates a Jupyterlab environment in the browser and can be hosted as a GitHub page.</p></li>
<li><p><a class="reference external" href="https://github.com/aaren/notedown">Notedown</a>, <a class="reference external" href="https://github.com/QuantEcon/sphinxcontrib-jupyter">Jupinx</a> and <a class="reference external" href="https://github.com/hplgit/doconce">DocOnce</a> can take Markdown or Sphinx files and generate Jupyter Notebooks</p></li>
<li><p><a class="reference external" href="https://voila.readthedocs.io/en/stable/">Voilà</a> allows you to convert a Jupyter Notebook into an interactive dashboard</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">nbconvert</span></code> tool can convert a (<code class="docutils literal notranslate"><span class="pre">.ipynb</span></code>) notebook file to:</p>
<ul>
<li><p>python code (<code class="docutils literal notranslate"><span class="pre">.py</span></code> file)</p></li>
<li><p>an HTML file</p></li>
<li><p>a LaTeX file</p></li>
<li><p>a PDF file</p></li>
<li><p>a slide-show in the browser</p></li>
</ul>
</li>
</ul>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="_images/JupyterDownload.png"><img alt="You can export Jupyter Notebooks to various formats. Some might need extra installations." src="_images/JupyterDownload.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">You can export Jupyter Notebooks to various formats. Some might need extra installations.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<section id="commercial-offers-with-free-plans">
<h4>Commercial offers with free plans<a class="headerlink" href="#commercial-offers-with-free-plans" title="Link to this heading"></a></h4>
<p>These platforms can be used free of charge but have paid subscriptions for
faster access to cloud resources:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://cocalc.com/">CoCalc</a> (formerly SageMathCloud) allows collaborative editing of notebooks in the cloud</p></li>
<li><p>Google’s <a class="reference external" href="https://colab.research.google.com/">Colaboratory</a> lets you work on notebooks in the cloud, and you can <a class="reference external" href="https://colab.research.google.com/notebooks/io.ipynb">read and write to notebook files on Drive</a></p></li>
<li><p><a class="reference external" href="https://notebooks.azure.com/">Microsoft Azure Notebooks</a> also offers free notebooks in the cloud</p></li>
<li><p><a class="reference external" href="https://deepnote.com/">Deepnote</a> allows real-time collaboration</p></li>
</ul>
<hr class="docutils" />
</section>
</section>
<section id="sharing-dynamic-notebooks-on-binder">
<span id="reproducible-via-binder"></span><h3>Sharing dynamic notebooks on <a class="reference external" href="https://mybinder.org">Binder</a><a class="headerlink" href="#sharing-dynamic-notebooks-on-binder" title="Link to this heading"></a></h3>
<div class="admonition-exercise-20-min-making-your-notebooks-reproducible-by-anyone-via-binder exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise (20 min): Making your notebooks reproducible by anyone via Binder</p>
<ul>
<li><p>Create a new GitHub repository and <strong>click on “Add a README file”</strong>: <a class="reference external" href="https://github.com/new">https://github.com/new</a></p></li>
<li><p>This exercise can be done entirely through the GitHub web interface (but
using the terminal is of course also OK). You can use the “Add file” button
to upload files:</p>
<figure class="align-default" id="id2">
<img alt="Screenshot of Binder web interface" src="_images/github-upload.png" />
<figcaption>
<p><span class="caption-text">Screenshot of Binder web interface.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
</li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-SnVweXRlciBOb3RlYm9va3M=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-SnVweXRlciBOb3RlYm9va3M=" name="SnVweXRlciBOb3RlYm9va3M=" role="tab" tabindex="0">Jupyter Notebooks</button><button aria-controls="panel-0-UiBNYXJrZG93bi9SIFN0dWRpbyBwcm9qZWN0" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-UiBNYXJrZG93bi9SIFN0dWRpbyBwcm9qZWN0" name="UiBNYXJrZG93bi9SIFN0dWRpbyBwcm9qZWN0" role="tab" tabindex="-1">R Markdown/R Studio project</button></div><div aria-labelledby="tab-0-SnVweXRlciBOb3RlYm9va3M=" class="sphinx-tabs-panel group-tab" id="panel-0-SnVweXRlciBOb3RlYm9va3M=" name="SnVweXRlciBOb3RlYm9va3M=" role="tabpanel" tabindex="0"><ul>
<li><p>Upload the notebook which we have created earlier to this repository. If you got stuck earlier,
you can download <a class="reference external" href="https://raw.githubusercontent.com/coderefinery/jupyter/main/example/darts.ipynb">this notebook</a>
(right-click, “Save as …”). You can also try this with a different notebook.</p></li>
<li><p>Add also a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file which contains (adapt this if your notebook has other dependencies):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matplotlib</span><span class="o">==</span><span class="mf">3.4.1</span>
</pre></div>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-0-UiBNYXJrZG93bi9SIFN0dWRpbyBwcm9qZWN0" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-UiBNYXJrZG93bi9SIFN0dWRpbyBwcm9qZWN0" name="UiBNYXJrZG93bi9SIFN0dWRpbyBwcm9qZWN0" role="tabpanel" tabindex="0"><p>This exercise is for those who use Rmd files instead of Jupyter notebooks.</p>
<ul>
<li><p>Upload or push your Rmd file to this GitHub repository.</p></li>
<li><p>Add a file <code class="docutils literal notranslate"><span class="pre">runtime.txt</span></code> which specifies the R version you want to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="o">-</span><span class="mf">3.6</span><span class="o">-</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">13</span>
</pre></div>
</div>
</li>
<li><p>Add a file <code class="docutils literal notranslate"><span class="pre">install.R</span></code> which lists the dependencies, for instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">install</span><span class="o">.</span><span class="n">packages</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;readr&quot;</span><span class="p">,</span> <span class="s2">&quot;ggplot2&quot;</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>After you have done that, visit
https://mybinder.org/v2/gh/<strong>USER</strong>/<strong>REPOSITORY</strong>/<strong>BRANCH</strong>?urlpath=rstudio (adapt
“USER”, “REPOSITORY”, and “BRANCH”).</p></li>
<li><p>For more information, see <a class="reference external" href="https://github.com/alan-turing-institute/the-turing-way/blob/master/workshops/boost-research-reproducibility-binder/workshop-presentations/zero-to-binder-r.md">this
guide</a>.</p></li>
</ul>
</div></div>
<ul>
<li><p>Visit <a class="reference external" href="https://mybinder.org">https://mybinder.org</a>:</p>
<figure class="align-default" id="id3">
<img alt="Screenshot of Binder web interface" src="_images/binder.jpg" />
<figcaption>
<p><span class="caption-text">Screenshot of Binder web interface.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
</li>
<li><p>Copy-paste the markdown text for the mybinder badge into a README.md file in your notebook repository.</p></li>
<li><p>Check that your notebook repository now has a “launch binder”
badge in your <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file on GitHub.</p></li>
<li><p>Try clicking the button and see how your repository is launched
on Binder (can take a minute or two). Your notebooks can now be expored and executed in the cloud.</p></li>
<li><p>Enjoy being fully reproducible! Even better would be to get a DOI to your
notebook and point Binder to the DOI.</p></li>
</ul>
</div>
<div class="admonition-more-examples-with-binder keypoints admonition" id="keypoints-0">
<p class="admonition-title">More examples with Binder:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://mybinder.readthedocs.io/en/latest/introduction.html">Binder documentation</a></p></li>
<li><p><a class="reference external" href="https://github.com/binder-examples">Collection of example repositories</a></p></li>
</ul>
</div>
</section>
<hr class="docutils" />
<section id="optional-exercises">
<h3>Optional exercises<a class="headerlink" href="#optional-exercises" title="Link to this heading"></a></h3>
<section id="importance-of-tracking-dependencies">
<span id="without-requirements"></span><h4>Importance of tracking dependencies<a class="headerlink" href="#importance-of-tracking-dependencies" title="Link to this heading"></a></h4>
<div class="admonition-optional-exercise-what-happens-without-requirements-txt exercise important admonition" id="exercise-1">
<p class="admonition-title">(Optional) Exercise: what happens without requirements.txt?</p>
<p>Let’s look at the same <a class="reference external" href="https://github.com/timalthoff/activityinequality">activity inequality
repository</a>.</p>
<ul>
<li><p>Start the repository in Binder <a class="reference external" href="https://mybinder.org/v2/gh/timalthoff/activityinequality/master">using this link</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fig3/fig3bc.ipynb</span></code> is a Python notebook, so it works in Binder.
Most others are in R, which also works in Binder. <a class="reference external" href="https://mybinder.readthedocs.io/en/latest/howto/languages.html">But
how?</a></p></li>
<li><p>Try to run the notebook. What happens?</p></li>
<li><p>Most likely the run breaks down immediately in the first cell:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cycle</span>
</pre></div>
</div>
<p>We get a long list of <code class="docutils literal notranslate"><span class="pre">ModuleNotFoundError</span></code> messages. This is
because the required Python packages have not been installed and can not be imported.
The missing packages include, at least, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> mentioned in the
error message.</p>
</li>
<li><p>To install the missing requirements, add a new code cell to the beginning of the
notebook with the contents</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!python3 -m pip install pandas matplotlib
</pre></div>
</div>
<p>and run the notebook again. What happens now?</p>
</li>
<li><p>Again, the run breaks due to missing packages. This time the culprit is the
<code class="docutils literal notranslate"><span class="pre">seaborn</span></code> package. Modify the first cell to also install it with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!python3 -m pip install pandas matplotlib seaborn
</pre></div>
</div>
<p>and try to run the notebook for the third time. Does it finally work?
What could have been done differently by the developer?</p>
</li>
<li><p>A good way to make a notebook more usable is to create a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file
containing the necessary packages to run the notebook and add it next to the notebook
in the repository.</p></li>
<li><p>In this case, the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> could look like this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pandas</span>
<span class="n">matplotlib</span>
<span class="n">seaborn</span>
</pre></div>
</div>
<p>and to make sure the packages are installed, one could add a code cell to the beginning
of original notebook with the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!python3 -m pip install -r requirements.txt
</pre></div>
</div>
<p>To make sure that the notebook will continue to work also in few months,
you might want to specify also the version in the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file.</p>
</li>
</ul>
</div>
</section>
<section id="sharing-an-interactive-notebook-on-binder">
<span id="share-widget"></span><h4>Sharing an interactive notebook on Binder<a class="headerlink" href="#sharing-an-interactive-notebook-on-binder" title="Link to this heading"></a></h4>
<div class="admonition-optional-exercise-share-an-interactive-ipywidgets-notebook-via-binder exercise important admonition" id="exercise-2">
<p class="admonition-title">(Optional) Exercise: share an interactive (ipywidgets) notebook via Binder</p>
<ul>
<li><p>Take the solution from the exercise “Widgets for interactive data fitting” in the <a class="reference internal" href="#document-examples"><span class="doc">Examples of Jupyter features</span></a>
episode and paste it into a notebook.</p></li>
<li><p>Push the notebook to a GitHub/GitLab repository.</p></li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file in your notebook repository, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipywidgets</span><span class="o">==</span><span class="mf">7.4.2</span>
<span class="n">numpy</span><span class="o">==</span><span class="mf">1.16.4</span>
<span class="n">matplotlib</span><span class="o">==</span><span class="mf">3.1.0</span>
</pre></div>
</div>
</li>
<li><p>Try to deploy this example via Binder in the same way as the above exercise.</p></li>
</ul>
</div>
</section>
</section>
</section>
<span id="document-summary"></span><section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading"></a></h2>
<section id="recommendations-for-longer-notebooks">
<h3>Recommendations for longer notebooks<a class="headerlink" href="#recommendations-for-longer-notebooks" title="Link to this heading"></a></h3>
<section id="create-a-table-of-contents-on-top">
<h4>Create a table of contents on top<a class="headerlink" href="#create-a-table-of-contents-on-top" title="Link to this heading"></a></h4>
<p>You can do that using Markdown. This produces a nice overview for longer notebooks.
Example: <a class="reference external" href="https://stackoverflow.com/a/39817243">https://stackoverflow.com/a/39817243</a></p>
</section>
<section id="jupyter-book">
<h4>Jupyter Book<a class="headerlink" href="#jupyter-book" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://jupyterbook.org">https://jupyterbook.org</a></p></li>
<li><p>You can cite and cross-reference</p></li>
<li><p>You can toggle cell visibility</p></li>
<li><p>… and a lot more</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="discussion-points">
<h3>Discussion points<a class="headerlink" href="#discussion-points" title="Link to this heading"></a></h3>
<div class="admonition-use-cases-and-reproducibility discussion important admonition" id="discussion-0">
<p class="admonition-title">Use cases and reproducibility</p>
<ul class="simple">
<li><p>If you are already using Jupyter, what tasks do you use it for?</p></li>
<li><p>If you are new to Jupyter, do you see any possible use cases?</p></li>
<li><p>Do you think Jupyter Notebooks can help tackle the problem of irreproducible results?</p></li>
</ul>
</div>
<div class="admonition-are-jupyter-notebooks-workflows discussion important admonition" id="discussion-1">
<p class="admonition-title">Are Jupyter notebooks “workflows”?</p>
<ul class="simple">
<li><p>A reproducible workflow documents a “pipeline”</p></li>
<li><p>Also a Jupyter notebook can be a data processing and visualization pipeline</p></li>
<li><p>Are Jupyter notebooks “workflows”?</p></li>
</ul>
</div>
</section>
<hr class="docutils" />
<section id="interesting-blog-posts-and-articles">
<h3>Interesting blog posts and articles<a class="headerlink" href="#interesting-blog-posts-and-articles" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://blog.jetbrains.com/datalore/2020/12/17/we-downloaded-10-000-000-jupyter-notebooks-from-github-this-is-what-we-learned/">A. Guzharina, “We Downloaded 10,000,000 Jupyter Notebooks From Github – This Is What We Learned”</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1038/d41586-021-01174-w">J. M. Perkel, “Reactive, reproducible, collaborative: computational notebooks evolve”, Nature 593, 156-157 (2021)</a></p></li>
</ul>
</section>
<hr class="docutils" />
<section id="similar-tools-for-other-languages">
<h3>Similar tools for other languages<a class="headerlink" href="#similar-tools-for-other-languages" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>R: <a class="reference external" href="https://shiny.rstudio.com/gallery/">R Shiny</a>, <a class="reference external" href="https://rmarkdown.rstudio.com/">R Markdown</a></p></li>
<li><p>JavaScript: <a class="reference external" href="https://observablehq.com/">Observable</a></p></li>
<li><p>Julia: <a class="reference external" href="https://github.com/fonsp/Pluto.jl">Pluto</a></p></li>
</ul>
</section>
<hr class="docutils" />
<section id="avoiding-repetitive-code">
<h3>Avoiding repetitive code<a class="headerlink" href="#avoiding-repetitive-code" title="Link to this heading"></a></h3>
<p><strong>It all started with a short and simple notebook</strong> but how to organize as projects and
notebooks grow?</p>
<p>Let’s imagine we wrote this function <code class="docutils literal notranslate"><span class="pre">fancy_plot</span></code> for a hexagonal 2D histogram plot
(please try it in your notebook):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>

<span class="c1"># to get some random numbers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.random</span><span class="w"> </span><span class="kn">import</span> <span class="n">default_rng</span>


<span class="hll"><span class="c1"># this one is simple but let us imagine something very lengthy</span>
</span><span class="hll"><span class="k">def</span><span class="w"> </span><span class="nf">fancy_plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span class="hll"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Fancy function creating fancy plots.</span>
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_values</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hex&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">()</span>

<span class="n">x_values</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">y_values</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

<span class="c1"># call our function</span>
<span class="n">fancy_plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="s2">&quot;#4cb391&quot;</span><span class="p">)</span>


<span class="n">other_x_values</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">other_y_values</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

<span class="c1"># call our function again, this time with other data</span>
<span class="n">fancy_plot</span><span class="p">(</span><span class="n">other_x_values</span><span class="p">,</span> <span class="n">other_y_values</span><span class="p">,</span> <span class="s2">&quot;#fc9272&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we would like to use this function in 5 other notebooks without duplicating
it over all of the notebooks (imagine the function is very lengthy).</p>
<p>It can be useful to create a Python file <code class="docutils literal notranslate"><span class="pre">myplotfunctions.py</span></code> in the same
folder as the notebooks (you can change the name)
and place this code into <code class="docutils literal notranslate"><span class="pre">myplotfunctions.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>


<span class="c1"># this one is simple but let us imagine something very lengthy</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fancy_plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fancy function creating fancy plots.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_values</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hex&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can simplify our notebook:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># to get some random numbers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.random</span><span class="w"> </span><span class="kn">import</span> <span class="n">default_rng</span>

<span class="hll"><span class="kn">from</span><span class="w"> </span><span class="nn">myplotfunctions</span><span class="w"> </span><span class="kn">import</span> <span class="n">fancy_plot</span>
</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">()</span>

<span class="n">x_values</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">y_values</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

<span class="c1"># call our function</span>
<span class="hll"><span class="n">fancy_plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="s2">&quot;#4cb391&quot;</span><span class="p">)</span>
</span>

<span class="n">other_x_values</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">other_y_values</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

<span class="c1"># call our function again, this time with other data</span>
<span class="hll"><span class="n">fancy_plot</span><span class="p">(</span><span class="n">other_x_values</span><span class="p">,</span> <span class="n">other_y_values</span><span class="p">,</span> <span class="s2">&quot;#fc9272&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-extra-features"></span><section id="shell-commands-magics-and-widgets">
<h2>Shell commands, magics and widgets<a class="headerlink" href="#shell-commands-magics-and-widgets" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>Are there any other features besides code, text and output?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn how to access help.</p></li>
<li><p>Learn how to use magics and shell commands.</p></li>
<li><p>Learn how to use widgets.</p></li>
</ul>
</div>
<section id="extra-features">
<h3>Extra features<a class="headerlink" href="#extra-features" title="Link to this heading"></a></h3>
<section id="access-to-help">
<h4>Access to help<a class="headerlink" href="#access-to-help" title="Link to this heading"></a></h4>
<p>We can get help on an object using a question mark:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import numpy as np
np.sum?
</pre></div>
</div>
<p>Or two question marks to also see the source code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>np.sum??
</pre></div>
</div>
<p>List all names in a module matching pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>?np.*sum*
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span>
<span class="n">np</span><span class="o">.</span><span class="n">einsum</span>
<span class="n">np</span><span class="o">.</span><span class="n">einsum_path</span>
<span class="n">np</span><span class="o">.</span><span class="n">nancumsum</span>
<span class="n">np</span><span class="o">.</span><span class="n">nansum</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">%quickref</span></code> shows a quick reference card of features and shortcuts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">quickref</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="shell-commands">
<h4>Shell commands<a class="headerlink" href="#shell-commands" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>You can run shell commands by prepending with “!”</p>
<ul>
<li><p>On Windows, GitBash needs to have the following option enabled:
<code class="docutils literal notranslate"><span class="pre">Use</span> <span class="pre">Git</span> <span class="pre">and</span> <span class="pre">the</span> <span class="pre">optional</span> <span class="pre">Unix</span> <span class="pre">tools</span> <span class="pre">from</span> <span class="pre">the</span> <span class="pre">Windows</span> <span class="pre">Command</span> <span class="pre">Prompt</span></code></p></li>
</ul>
</li>
<li><p>Make sure your cell command doesn’t require interaction</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!echo &quot;hello&quot;
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hello</span>
</pre></div>
</div>
<p>We can also capture the output of a shell command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>notebooks = !ls *.ipynb
</pre></div>
</div>
<ul class="simple">
<li><p>Common linux shell commands are also available as <em>magics</em>: %ls, %pwd, %mkdir, %cp, %mv, %cd, <em>etc.</em>.</p></li>
<li><p>Using shell commands can be useful when testing a new idea but <strong>for reproducible notebooks be careful
with shell commands</strong> (will they also work on a different computer?).</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="magics">
<h4>Magics<a class="headerlink" href="#magics" title="Link to this heading"></a></h4>
<p>Magics are a simple command language which significantly extend the power of Jupyter.</p>
<p>There are two kinds of magics:</p>
<ul class="simple">
<li><p><strong>Line magics</strong>: commands prepended by one % character and whose arguments only extend to the end of the current line.</p></li>
<li><p><strong>Cell magics</strong>: use two percent characters as a marker (%%), receive as argument the whole cell (must be used as the first line in a cell)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">%lsmagic</span></code> lists all available line and cell magics:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">lsmagic</span>
</pre></div>
</div>
<p>Question mark shows help:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%sx?
</pre></div>
</div>
<p>Additional magics can also be installed or created.</p>
</section>
<hr class="docutils" />
<section id="widgets">
<h4>Widgets<a class="headerlink" href="#widgets" title="Link to this heading"></a></h4>
<p>Widgets add more interactivity to Notebooks, allowing one to visualize and control changes in data, parameters etc.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">interact</span>
</pre></div>
</div>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">ipywidgets</span></code> package is included in the standard
CodeRefinery conda environment, but if you run into problems getting widgets to work
please refer to the official <a class="reference external" href="https://ipywidgets.readthedocs.io/en/latest/user_install.html">installation instructions</a>.</p>
</div></blockquote>
<section id="use-interact-as-a-function">
<h5>Use <code class="docutils literal notranslate"><span class="pre">interact</span></code> as a function<a class="headerlink" href="#use-interact-as-a-function" title="Link to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="n">interact</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s2">&quot;Hello&quot;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="use-interact-as-a-decorator">
<h5>Use <code class="docutils literal notranslate"><span class="pre">interact</span></code> as a decorator<a class="headerlink" href="#use-interact-as-a-decorator" title="Link to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@interact</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-does-it-not-work-extensions-need-to-be-installed discussion important admonition" id="discussion-0">
<p class="admonition-title">Does it not work?  Extensions need to be installed.</p>
<p>The widgets interface have to be installed.  JupyterLab is modular,
and some parts need to be installed as an extension.  In general,
copy and paste the command into a shell (the JupyterLab shell works
fine).  See the <a class="reference external" href="https://coderefinery.github.io/installation/jupyter/#jupyterlab-extension-manager">installation instructions</a>.</p>
<p>After installation, you need to reload the page to make it active
(and if you installed it with pip or conda, restart the whole
JupyterLab server)</p>
</div>
<hr class="docutils" />
<div class="admonition-a-few-useful-magic-commands exercise important admonition" id="exercise-0">
<p class="admonition-title">A few useful magic commands</p>
<p>Using the computing-pi notebook, practice using a few magic commands.
Remember that cell magics need to be on the first line of the cell.</p>
<ol class="arabic simple">
<li><p>In the cell with the for-loop over <code class="docutils literal notranslate"><span class="pre">num_points</span></code> (throwing darts), add the
<code class="docutils literal notranslate"><span class="pre">%%timeit</span></code> cell magic and run the cell.</p></li>
<li><p>In the same cell, try instead the <code class="docutils literal notranslate"><span class="pre">%%prun</span></code> cell profiling magic.</p></li>
<li><p>Try introducing a bug in the code (e.g., use an incorrect variable name:
<code class="docutils literal notranslate"><span class="pre">points.append((x,</span> <span class="pre">y2,</span> <span class="pre">True))</span></code>)</p>
<ul class="simple">
<li><p>run the cell</p></li>
<li><p>after the exception occurs, run the <code class="docutils literal notranslate"><span class="pre">%debug</span></code> magic in a new cell
to enter an interactive debugger</p></li>
<li><p>type <code class="docutils literal notranslate"><span class="pre">h</span></code> for a help menu, and <code class="docutils literal notranslate"><span class="pre">help</span> <span class="pre">&lt;keyword&gt;</span></code> for help on keyword</p></li>
<li><p>type <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">x</span></code> to print the value of <code class="docutils literal notranslate"><span class="pre">x</span></code></p></li>
<li><p>exit the debugger by typing <code class="docutils literal notranslate"><span class="pre">q</span></code></p></li>
</ul>
</li>
<li><p>Have a look at the output of <code class="docutils literal notranslate"><span class="pre">%lsmagic</span></code>, and use a question mark and
double question mark to see help for a magic command that raises
your interest.</p></li>
</ol>
</div>
<div class="admonition-playing-around-with-a-widget exercise important admonition" id="exercise-1">
<p class="admonition-title">Playing around with a widget</p>
<p>Widgets can be used to interactively explore or analyze data.</p>
<ol class="arabic">
<li><p>We return to the pi approximation example and create a new cell where
we reuse code that we have written earlier but this time we place the
code into functions. This “hides” details and allows us to reuse the functions
later or in other notebooks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">widgets</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span>


<span class="k">def</span><span class="w"> </span><span class="nf">throw_darts</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
    <span class="n">fraction</span> <span class="o">=</span> <span class="n">hits</span> <span class="o">/</span> <span class="n">num_points</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">fraction</span>
    <span class="k">return</span> <span class="n">pi</span><span class="p">,</span> <span class="n">points</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_plot</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">experiment</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
    <span class="n">pi</span><span class="p">,</span> <span class="n">points</span> <span class="o">=</span> <span class="n">throw_darts</span><span class="p">(</span><span class="n">num_points</span><span class="p">)</span>
    <span class="n">create_plot</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;approximation:&quot;</span><span class="p">,</span> <span class="n">pi</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Try to call the <code class="docutils literal notranslate"><span class="pre">experiment</span></code> function with e.g. <code class="docutils literal notranslate"><span class="pre">num_points</span></code> set to 2000.</p></li>
<li><p>Add a cell where we will make it possible to vary the number of points interactively:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">interact</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">num_points</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
</pre></div>
</div>
<p>If you run into <code class="docutils literal notranslate"><span class="pre">Error</span> <span class="pre">displaying</span> <span class="pre">widget:</span> <span class="pre">model</span> <span class="pre">not</span> <span class="pre">found</span></code>, you may need to refresh the page.</p>
</li>
<li><p>Drag the slider back and forth and observe the results.</p></li>
<li><p>Can you think of other interesting uses of widgets?</p></li>
</ol>
</div>
<div class="admonition-rshiny-is-a-nice-r-alternative-solution-a-la-ipywidgets discussion important admonition" id="discussion-1">
<p class="admonition-title">RShiny is a nice R alternative/solution à la ipywidgets</p>
<p><a class="reference external" href="https://shiny.rstudio.com">RShiny</a> is a nice R alternative/solution a la
ipywidgets which can be interesting for R developers.</p>
<p>See for instance their <a class="reference external" href="https://shiny.rstudio.com/gallery/">gallery of examples</a>.</p>
</div>
<hr class="docutils" />
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Jupyter notebooks have a number of extra features that can come in handy.</p></li>
</ul>
</div>
</section>
</section>
</section>
</section>
<span id="document-examples"></span><section id="examples-of-jupyter-features">
<h2>Examples of Jupyter features<a class="headerlink" href="#examples-of-jupyter-features" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>Mixed examples/exercises to practice various aspects of using Jupyter</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn more advanced usage of widgets.</p></li>
<li><p>Learn how to profile code and install a new line-profiler tool.</p></li>
<li><p>Practice some data analysis using pandas dataframes.</p></li>
<li><p>Learn how to define your own magic command.</p></li>
<li><p>Learn how to parallelize Python code using ipyparallel.</p></li>
<li><p>Learn how to mix Python with R in the same noteobook.</p></li>
</ul>
</div>
<hr class="docutils" />
<section id="widgets-for-interactive-data-fitting">
<span id="interactive-data-fitting"></span><h3>Widgets for interactive data fitting<a class="headerlink" href="#widgets-for-interactive-data-fitting" title="Link to this heading"></a></h3>
<div class="admonition-widgets-for-interactive-data-fitting exercise important admonition" id="exercise-0">
<p class="admonition-title">Widgets for interactive data fitting</p>
<p>Widgets are fun, but they can also be useful. Here’s an example showing how you can fit noisy data interactively.</p>
<ol class="arabic simple">
<li><p>Execute the cell below. It fits a 5th order polynomial to a gaussian function with some random noise</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">&#64;interact</span></code> decorator around the last two code lines
such that you can visualize fits with polynomial orders <code class="docutils literal notranslate"><span class="pre">n</span></code>
ranging from, say, 3 to 30:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="k">def</span><span class="w"> </span><span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">noisy_gaussian</span><span class="p">():</span>
    <span class="c1"># gaussian array y in interval -5 &lt;= x &lt;= 5</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">+=</span> <span class="n">noise</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">pfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">yfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">pfit</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yfit</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yfit</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yfit</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Fit&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">noisy_gaussian</span><span class="p">()</span>
<span class="n">yfit</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># fit a 5th order polynomial to it</span>
<span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yfit</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">interact</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="k">def</span><span class="w"> </span><span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">noisy_gaussian</span><span class="p">():</span>
    <span class="c1"># gaussian array y in interval -5 &lt;= x &lt;= 5</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">+=</span> <span class="n">noise</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">pfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">yfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">pfit</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yfit</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yfit</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yfit</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Fit&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">noisy_gaussian</span><span class="p">()</span>

<span class="nd">@interact</span>
<span class="k">def</span><span class="w"> </span><span class="nf">slider</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">30</span><span class="p">)):</span>
    <span class="n">yfit</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yfit</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
</section>
<section id="cell-profiling">
<span id="id1"></span><h3>Cell profiling<a class="headerlink" href="#cell-profiling" title="Link to this heading"></a></h3>
<div class="admonition-cell-profiling exercise important admonition" id="exercise-1">
<p class="admonition-title">Cell profiling</p>
<p>This exercise is about cell profiling, but you will get practice in
working with magics and cells.</p>
<ol class="arabic">
<li><p>Copy-paste the following code into a cell:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">():</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
    <span class="k">return</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">.5</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span>

<span class="k">def</span><span class="w"> </span><span class="nf">walk</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">step</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x_new</span> <span class="o">&gt;</span> <span class="mf">5e-3</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_new</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">walk</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Split up the functions over 4 cells (either via Edit menu or keyboard shortcut <code class="docutils literal notranslate"><span class="pre">Ctrl-Shift-minus</span></code>).</p></li>
<li><p>Plot the random walk trajectory using <code class="docutils literal notranslate"><span class="pre">plt.plot(x)</span></code>.</p></li>
<li><p>Time the execution of <code class="docutils literal notranslate"><span class="pre">walk()</span></code> with a line magic.</p></li>
<li><p>Run the prun cell profiler.</p></li>
<li><p>Can you spot a little mistake which is slowing down the code?</p></li>
<li><p>In the next exercise you will install a line profiler which
will more easily expose the performance mistake.</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<p>Split the code over multiple cells (e.g. using <code class="docutils literal notranslate"><span class="pre">Ctrl-Shift-minus</span></code>)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">():</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
    <span class="k">return</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">.5</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">walk</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">step</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x_new</span> <span class="o">&gt;</span> <span class="mf">5e-3</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_new</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>Initialize <code class="docutils literal notranslate"><span class="pre">n</span></code> and call <code class="docutils literal notranslate"><span class="pre">walk()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">walk</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the random walk</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</pre></div>
</div>
<p>Time the execution using the <code class="docutils literal notranslate"><span class="pre">%timeit</span></code> line magic, and capture the output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t1</span> <span class="o">=</span> <span class="o">%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">o</span> <span class="n">walk</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>Best result</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t1</span><span class="o">.</span><span class="n">best</span>
</pre></div>
</div>
<p>Run with the <code class="docutils literal notranslate"><span class="pre">%%prun</span></code> cell profiler</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">prun</span>
<span class="n">walk</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
</section>
<section id="installing-a-magic-command-for-line-profiling">
<span id="installing-magic-command"></span><h3>Installing a magic command for line profiling<a class="headerlink" href="#installing-a-magic-command-for-line-profiling" title="Link to this heading"></a></h3>
<div class="admonition-installing-a-magic-command-for-line-profiling exercise important admonition" id="exercise-2">
<p class="admonition-title">Installing a magic command for line profiling</p>
<p>Magics can be installed using <code class="docutils literal notranslate"><span class="pre">pip</span></code> and loaded like plugins using the
<code class="docutils literal notranslate"><span class="pre">%load_ext</span></code> magic. You will now install a line-profiler to get more
detailed profile, and hopefully find insight to speed up the code
from the previous exercise.</p>
<ol class="arabic">
<li><p>If you haven’t solved the previous exercise, copy paste the following code into a cell
and run it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">():</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
    <span class="k">return</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">.5</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span>

<span class="k">def</span><span class="w"> </span><span class="nf">walk</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">step</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x_new</span> <span class="o">&gt;</span> <span class="mf">5e-3</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_new</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">walk</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Then install the line profiler using <code class="docutils literal notranslate"><span class="pre">!pip</span> <span class="pre">install</span> <span class="pre">line_profiler</span></code>.</p></li>
<li><p>Next load it using <code class="docutils literal notranslate"><span class="pre">%load_ext</span> <span class="pre">line_profiler</span></code>.</p></li>
<li><p>Have a look at the new magic command that has been enabled with <code class="docutils literal notranslate"><span class="pre">%lprun?</span></code></p></li>
<li><p>In a new cell, run the line profiler on the <code class="docutils literal notranslate"><span class="pre">walk</span></code> and <code class="docutils literal notranslate"><span class="pre">step</span></code> functions in the way
described on the help page.</p></li>
<li><p>Inspect the output. Can you more easily see the mistake now?</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solution</p>
<p>Copy-paste the code into a cell</p>
<p>Install the line profiler</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install line_profiler
</pre></div>
</div>
<p>Load the IPython extension</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">line_profiler</span>
</pre></div>
</div>
<p>See help:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%lprun?
</pre></div>
</div>
<p>Use the line profiler on the <code class="docutils literal notranslate"><span class="pre">walk</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">lprun</span> <span class="o">-</span><span class="n">f</span> <span class="n">walk</span> <span class="n">walk</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<p>Aha, most time is spent on the line calling the <code class="docutils literal notranslate"><span class="pre">step()</span></code> function.
Run line profiler on <code class="docutils literal notranslate"><span class="pre">step</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">lprun</span> <span class="o">-</span><span class="n">f</span> <span class="n">step</span> <span class="n">walk</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
     <span class="mi">8</span>                                           <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">():</span>
     <span class="mi">9</span>      <span class="mi">9999</span>       <span class="mf">7488.0</span>      <span class="mf">0.7</span>     <span class="mf">52.3</span>      <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
    <span class="mi">10</span>      <span class="mi">9999</span>       <span class="mf">6840.0</span>      <span class="mf">0.7</span>     <span class="mf">47.7</span>      <span class="k">return</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Aha! Lot’s of time is spent on importing the <code class="docutils literal notranslate"><span class="pre">random</span></code> module inside the <code class="docutils literal notranslate"><span class="pre">step</span></code> function
which is called thousands of times. Move the import statement to outside the function!</p>
</div>
</div>
<hr class="docutils" />
</section>
<section id="data-analysis-with-pandas-dataframes">
<span id="data-analysis"></span><h3>Data analysis with pandas dataframes<a class="headerlink" href="#data-analysis-with-pandas-dataframes" title="Link to this heading"></a></h3>
<div class="admonition-data-analysis-with-pandas-dataframes exercise important admonition" id="exercise-3">
<p class="admonition-title">Data analysis with pandas dataframes</p>
<p>Data science and data analysis are key use cases of Jupyter. In this
exercise you will familiarize yourself with dataframes and various
inbuilt analysis methods in the high-level <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data exploration
library. A dataset containing information on Nobel prizes will be viewed with the file browser.</p>
<ol class="arabic simple">
<li><p>Start by navigating in the File Browser to the <code class="docutils literal notranslate"><span class="pre">data/</span></code> subfolder, and
double-click on the <code class="docutils literal notranslate"><span class="pre">nobels.csv</span></code> dataset. This will open JupyterLab’s
inbuilt data browser.</p></li>
<li><p>Have a look at the data, column names, etc.</p></li>
<li><p>In a your own notebook, import the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> module and load the dataset into a <em>dataframe</em>:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">nobel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/nobels.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>The “share” column of the dataframe contains the number of Nobel recipients that shared the prize. Have a look at the statistics of this column using</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;share&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>The <code class="docutils literal notranslate"><span class="pre">describe()</span></code> method is smart about data types. Try this:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;bornCountryCode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- What country has received the largest number of Nobel prizes, and how many?
- How many countries are represented in the dataset?
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>Now analyze the age of prize recipients. You first need to convert the “born” column to datetime format:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">],</span>
                               <span class="n">errors</span> <span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>Next subtract the birth date from the year of receiving the prize and insert it into a new column “age”:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Now print the “surname” and “age” of first 10 entries using the <code class="docutils literal notranslate"><span class="pre">head()</span></code> method.</p></li>
</ul>
<ol class="arabic simple" start="8">
<li><p>Now plot results in two different ways:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">);</span>
<span class="n">nobel</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="9">
<li><p>Which Nobel laureates have been Swedish? See if you can use the <code class="docutils literal notranslate"><span class="pre">nobel.loc[CONDITION]</span></code> statement to extract the relevant rows from the <code class="docutils literal notranslate"><span class="pre">nobel</span></code> dataframe using the appropriate condition.</p></li>
<li><p>Finally, try the powerful <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> method to analyze the number of Nobel prizes per country, and visualize it with the high-level <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> plotting library.</p></li>
</ol>
<ul class="simple">
<li><p>First add a column “number” to the <code class="docutils literal notranslate"><span class="pre">nobel</span></code> dataframe containing 1’s (to enable the counting below).</p></li>
<li><p>Then extract any 4 countries (replace below) and create a subset of the dataframe:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">countries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">COUNTRY1</span><span class="p">,</span> <span class="n">COUNTRY2</span><span class="p">,</span> <span class="n">COUNTRY3</span><span class="p">,</span> <span class="n">COUNTRY4</span><span class="p">])</span>
<span class="n">nobel2</span> <span class="o">=</span> <span class="n">nobel</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nobel</span><span class="p">[</span><span class="s1">&#39;bornCountry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">countries</span><span class="p">)]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Next use <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> and <code class="docutils literal notranslate"><span class="pre">sum()</span></code>, and inspect the resulting dataframe:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobels_by_country</span> <span class="o">=</span> <span class="n">nobel2</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;bornCountry&#39;</span><span class="p">,</span><span class="s2">&quot;category&quot;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Next use the <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code> method to reshape the dataframe to a spreadsheet-like structure, and display the result:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">nobel2</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Finally visualize using a heatmap:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Have a look at the help page for <code class="docutils literal notranslate"><span class="pre">sns.heatmap</span></code> and see if you can find an
input parameter which annotates each cell in the plot with the count
number.</p></li>
</ul>
<div class="admonition-solution solution important dropdown admonition" id="solution-3">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">nobel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/nobels.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;share&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;bornCountryCode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>USA has received 275 prizes.</p></li>
<li><p>76 countries have received at least one prize.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">],</span> <span class="n">errors</span> <span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Add column</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
</pre></div>
</div>
<p>Print surname and age</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[[</span><span class="s2">&quot;surname&quot;</span><span class="p">,</span><span class="s2">&quot;age&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Which Nobel laureates have been Swedish?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sweden&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Finally, try the powerful <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> method.
Add extra column with number of Nobel prizes per row (needed for statistics)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
<p>Pick a few countries to analyze further</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">countries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;Sweden&quot;</span><span class="p">,</span> <span class="s2">&quot;United Kingdom&quot;</span><span class="p">,</span> <span class="s2">&quot;France&quot;</span><span class="p">,</span> <span class="s2">&quot;Denmark&quot;</span><span class="p">])</span>
<span class="n">nobel2</span> <span class="o">=</span> <span class="n">nobel</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nobel</span><span class="p">[</span><span class="s1">&#39;bornCountry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">countries</span><span class="p">)]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">nobel2</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span>
                           <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
<span class="n">table</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
</section>
<section id="defining-your-own-custom-magic-command">
<span id="own-magic-command"></span><h3>Defining your own custom magic command<a class="headerlink" href="#defining-your-own-custom-magic-command" title="Link to this heading"></a></h3>
<div class="admonition-defining-your-own-custom-magic-command exercise important admonition" id="exercise-4">
<p class="admonition-title">Defining your own custom magic command</p>
<p>It is possible to create new magic commands using the <code class="docutils literal notranslate"><span class="pre">&#64;register_cell_magic</span></code> decorator from the <code class="docutils literal notranslate"><span class="pre">IPython.core</span></code> library. Here you will create a cell magic command that compiles C++ code and executes it.
This exercise requires that you have the GNU <code class="docutils literal notranslate"><span class="pre">g++</span></code> compiler installed on your computer.</p>
<blockquote>
<div><p>This example has been adapted from the <a class="reference external" href="http://ipython-books.github.io/">IPython Minibook</a>, by Cyrille Rossant, Packt Publishing, 2015.</p>
</div></blockquote>
<ol class="arabic simple">
<li><p>First import <code class="docutils literal notranslate"><span class="pre">register_cell_magic</span></code></p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.core.magic</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_cell_magic</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Next copy-paste the following code into a cell, and execute it to
register the new cell magic command:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_cell_magic</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cpp</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compile, execute C++ code, and return the standard output.&quot;&quot;&quot;</span>

    <span class="c1"># We first retrieve the current IPython interpreter instance.</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>
    <span class="c1"># We define the source and executable filenames.</span>
    <span class="n">source_filename</span> <span class="o">=</span> <span class="s1">&#39;_temp.cpp&#39;</span>
    <span class="n">program_filename</span> <span class="o">=</span> <span class="s1">&#39;_temp&#39;</span>
    <span class="c1"># We write the code to the C++ file.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="c1"># We compile the C++ code into an executable.</span>
    <span class="nb">compile</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s2">&quot;g++ </span><span class="si">{0:s}</span><span class="s2"> -o </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">source_filename</span><span class="p">,</span> <span class="n">program_filename</span><span class="p">))</span>
    <span class="c1"># We execute the executable and return the output.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s1">&#39;./</span><span class="si">{0:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program_filename</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li><p>You can now start using the magic using <code class="docutils literal notranslate"><span class="pre">%%cpp</span></code>.</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>Write some C++ code into a cell and try executing it.</p></li>
<li><p>To be able to use the magic in another notebook, you need to add the
following function at the end and then write the cell to a file in
your PYTHONPATH. If the file is called <code class="docutils literal notranslate"><span class="pre">cpp_ext.py</span></code>, you can then
load it by <code class="docutils literal notranslate"><span class="pre">%load_ext</span> <span class="pre">cpp_ext</span></code>.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_ipython_extension</span><span class="p">(</span><span class="n">ipython</span><span class="p">):</span>
    <span class="n">ipython</span><span class="o">.</span><span class="n">register_magic_function</span><span class="p">(</span><span class="n">cpp</span><span class="p">,</span><span class="s1">&#39;cell&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-4">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.core.magic</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_cell_magic</span>
</pre></div>
</div>
<p>Add <code class="docutils literal notranslate"><span class="pre">load_ipython_extension</span></code> function, and write cell to file called <code class="docutils literal notranslate"><span class="pre">cpp_ext.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">cpp_ext</span><span class="o">.</span><span class="n">py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cpp</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compile, execute C++ code, and return the standard output.&quot;&quot;&quot;</span>

    <span class="c1"># We first retrieve the current IPython interpreter instance.</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>
    <span class="c1"># We define the source and executable filenames.</span>
    <span class="n">source_filename</span> <span class="o">=</span> <span class="s1">&#39;_temp.cpp&#39;</span>
    <span class="n">program_filename</span> <span class="o">=</span> <span class="s1">&#39;_temp&#39;</span>
    <span class="c1"># We write the code to the C++ file.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="c1"># We compile the C++ code into an executable.</span>
    <span class="nb">compile</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s2">&quot;g++ </span><span class="si">{0:s}</span><span class="s2"> -o </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">source_filename</span><span class="p">,</span> <span class="n">program_filename</span><span class="p">))</span>
    <span class="c1"># We execute the executable and return the output.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s1">&#39;./</span><span class="si">{0:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program_filename</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">load_ipython_extension</span><span class="p">(</span><span class="n">ipython</span><span class="p">):</span>
    <span class="n">ipython</span><span class="o">.</span><span class="n">register_magic_function</span><span class="p">(</span><span class="n">cpp</span><span class="p">,</span><span class="s1">&#39;cell&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Load extension:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">cpp_ext</span>
</pre></div>
</div>
<p>Get help on the cpp magic:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%%cpp?
</pre></div>
</div>
<p>Hello World program in C++</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Hello, World!&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
</section>
<section id="parallel-python-with-ipyparallel">
<span id="ipyparallel"></span><h3>Parallel Python with ipyparallel<a class="headerlink" href="#parallel-python-with-ipyparallel" title="Link to this heading"></a></h3>
<div class="admonition-parallel-python-with-ipyparallel exercise important admonition" id="exercise-5">
<p class="admonition-title">Parallel Python with ipyparallel</p>
<p>Traditionally, Python is considered to not support parallel programming very
well (<a class="reference external" href="https://en.wikipedia.org/wiki/Global_interpreter_lock">see “GIL”</a>),
and “proper” parallel programming should be left to “heavy-duty” languages
like Fortran or C/C++ where OpenMP and MPI can be utilised.</p>
<p>However, IPython now supports many different styles of parallelism which
can be useful to researchers. In particular, <code class="docutils literal notranslate"><span class="pre">ipyparallel</span></code> enables all
types of parallel applications to be developed, executed, debugged, and
monitored interactively. Possible use cases of <code class="docutils literal notranslate"><span class="pre">ipyparallel</span></code> include:</p>
<ul class="simple">
<li><p>Quickly parallelize algorithms that are embarrassingly parallel using
a number of simple approaches.</p></li>
<li><p>Run a set of tasks on a set of CPUs using dynamic load balancing.</p></li>
<li><p>Develop, test and debug new parallel algorithms (that may use MPI)
interactively.</p></li>
<li><p>Analyze and visualize large datasets (that could be remote and/or
distributed) interactively using IPython</p></li>
</ul>
<p>This exercise is just to get started, for a thorough treatment see the
<a class="reference external" href="https://ipyparallel.readthedocs.io/en/latest/">official documentation</a>
and <a class="reference external" href="https://github.com/DaanVanHauwermeiren/ipyparallel-tutorial">this detailed tutorial</a>.</p>
<ol class="arabic simple">
<li><p>First install <code class="docutils literal notranslate"><span class="pre">ipyparallel</span></code> using <code class="docutils literal notranslate"><span class="pre">conda</span></code> or <code class="docutils literal notranslate"><span class="pre">pip</span></code>. Open a terminal window
inside JupyterLab and do the installation.</p></li>
<li><p>After installing <code class="docutils literal notranslate"><span class="pre">ipyparallel</span></code>, you need to start an “IPython cluster”.
Do this in the terminal with <code class="docutils literal notranslate"><span class="pre">ipcluster</span> <span class="pre">start</span></code>.</p></li>
<li><p>Then import <code class="docutils literal notranslate"><span class="pre">ipyparallel</span></code> in your notebook, initialize a <code class="docutils literal notranslate"><span class="pre">Client</span></code> instance,
and create <em>DirectView</em> object for direct execution on the engines:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ipyparallel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ipp</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">ipp</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of ipyparallel engines:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">ids</span><span class="p">))</span>
<span class="n">dview</span> <span class="o">=</span> <span class="n">client</span><span class="p">[:]</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>You have now started the parallel engines. To run something simple on
each one of them, try the <code class="docutils literal notranslate"><span class="pre">apply_sync()</span></code> method:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dview</span><span class="o">.</span><span class="n">apply_sync</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="s2">&quot;Hello, World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>A serial evaluation of squares of integers can be seen in the code
snippet below.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serial_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)))</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Convert this to a parallel calculation on the engines using the
<code class="docutils literal notranslate"><span class="pre">map_sync()</span></code> method of the DirectView instance. Time both serial
and parallel versions using <code class="docutils literal notranslate"><span class="pre">%%timeit</span> <span class="pre">-n</span> <span class="pre">1</span></code>.</p></li>
</ul>
<ol class="arabic simple" start="6">
<li><p>You will now parallelize the evaluation of pi using a Monte Carlo
method. First load modules, and export the <code class="docutils literal notranslate"><span class="pre">random</span></code> module to the engines:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">pi</span>
<span class="n">dview</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span>
</pre></div>
</div>
<p>Then execute the following code in a cell. The function <code class="docutils literal notranslate"><span class="pre">mcpi</span></code> is a Monte
Carlo method to calculate $\pi$. Time the execution of this function using
<code class="docutils literal notranslate"><span class="pre">%timeit</span> <span class="pre">-n</span> <span class="pre">1</span></code> and a sample size of 10 million (<code class="docutils literal notranslate"><span class="pre">int(1e7)</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mcpi</span><span class="p">(</span><span class="n">nsamples</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsamples</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">s</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="mf">4.</span><span class="o">*</span><span class="n">s</span><span class="o">/</span><span class="n">nsamples</span>
</pre></div>
</div>
<p>Now take the incomplete function below which takes a <code class="docutils literal notranslate"><span class="pre">DirectView</span></code> object
and a number of samples, divides the number of samples between the engines,
and calls <code class="docutils literal notranslate"><span class="pre">mcpi()</span></code> with a subset of the samples on each engine. Complete
the function (by replacing the <code class="docutils literal notranslate"><span class="pre">____</span></code> fields), call it with $10^7$ samples,
time it and compare with the serial call to <code class="docutils literal notranslate"><span class="pre">mcpi()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">multi_mcpi</span><span class="p">(</span><span class="n">dview</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">):</span>
    <span class="c1"># get total number target engines</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">____</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nsamples</span> <span class="o">%</span> <span class="n">p</span><span class="p">:</span>
        <span class="c1"># ensure even divisibility</span>
        <span class="n">nsamples</span> <span class="o">+=</span> <span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="n">nsamples</span><span class="o">%</span><span class="n">p</span><span class="p">)</span>

    <span class="n">subsamples</span> <span class="o">=</span> <span class="n">____</span><span class="o">//</span><span class="n">p</span>

    <span class="n">ar</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mcpi</span><span class="p">,</span> <span class="n">____</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span><span class="o">/</span><span class="n">____</span>
</pre></div>
</div>
<p>Final note: While parallelizing Python code is often worth it, there
are other ways to get higher performance out of Python code. In
particular, fast numerical packages like <a class="reference external" href="http://www.numpy.org/">Numpy</a>
should be used, and significant speedup can be obtained with just-in-time
compilation with <a class="reference external" href="https://numba.pydata.org/">Numba</a> and/or C-extensions
from <a class="reference external" href="http://cython.org/">Cython</a>.</p>
<div class="admonition-solution solution important dropdown admonition" id="solution-5">
<p class="admonition-title">Solution</p>
<p>Open terminal, run <code class="docutils literal notranslate"><span class="pre">ipcluster</span> <span class="pre">start</span></code> and wait a few seconds for the engines to start.
Import module, create client and DirectView object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ipyparallel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ipp</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">ipp</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">dview</span> <span class="o">=</span> <span class="n">client</span><span class="p">[:]</span>
<span class="n">dview</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">DirectView</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Time the serial evaluation of the squaring lambda function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span>
<span class="n">serial_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)))</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">map_sync</span></code> method of the DirectView instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span>
<span class="n">parallel_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dview</span><span class="o">.</span><span class="n">map_sync</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)))</span>
</pre></div>
</div>
<p>There probably won’t be any speedup due to the communication overhead.</p>
<p>Focus instead on computing pi. Import modules, export <code class="docutils literal notranslate"><span class="pre">random</span></code> module to engines:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">pi</span>
<span class="n">dview</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mcpi</span><span class="p">(</span><span class="n">nsamples</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsamples</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">s</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="mf">4.</span><span class="o">*</span><span class="n">s</span><span class="o">/</span><span class="n">nsamples</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span>
<span class="n">mcpi</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e7</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>3.05 s ± 97.1 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre></div>
</div>
<p>Function for splitting up the samples and dispatching the chunks to the engines:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">multi_mcpi</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nsamples</span> <span class="o">%</span> <span class="n">p</span><span class="p">:</span>
        <span class="c1"># ensure even divisibility</span>
        <span class="n">nsamples</span> <span class="o">+=</span> <span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="n">nsamples</span><span class="o">%</span><span class="n">p</span><span class="p">)</span>

    <span class="n">subsamples</span> <span class="o">=</span> <span class="n">nsamples</span><span class="o">//</span><span class="n">p</span>

    <span class="n">ar</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mcpi</span><span class="p">,</span> <span class="n">subsamples</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span><span class="o">/</span><span class="n">p</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span>
<span class="n">multi_mcpi</span><span class="p">(</span><span class="n">dview</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e7</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1.71 s ± 30.4 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre></div>
</div>
<p>Some speedup is seen!</p>
</div>
</div>
<hr class="docutils" />
</section>
<section id="mixing-python-and-r">
<span id="mixing-python-r"></span><h3>Mixing Python and R<a class="headerlink" href="#mixing-python-and-r" title="Link to this heading"></a></h3>
<div class="admonition-mixing-python-and-r exercise important admonition" id="exercise-6">
<p class="admonition-title">Mixing Python and R</p>
<p>Your goal now is to define a pandas dataframe, and pass it into an R cell
and plot it with an R plotting library.</p>
<ol class="arabic simple">
<li><p>First you need to install the necessary packages:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!conda install -c r r-essentials
!conda install -y rpy2
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>To run R from the Python kernel we need to load the rpy2 extension:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">rpy2</span><span class="o">.</span><span class="n">ipython</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Run the following code in a code cell and plot it with the basic plot
method of pandas dataframes:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;cups_of_coffee&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
    <span class="s1">&#39;productivity&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Now take the following R code, and use the <code class="docutils literal notranslate"><span class="pre">%%R</span></code> magic command to pass
in and plot the pandas dataframe defined above (to find out how, use
<code class="docutils literal notranslate"><span class="pre">%%R?</span></code>):</p></li>
</ol>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cups_of_coffee</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">productivity</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">geom_line</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Play around with the flags for height, width, units and resolution to get a good looking graph.</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-6">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
 <span class="s1">&#39;cups_of_coffee&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
 <span class="s1">&#39;productivity&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">rpy2</span><span class="o">.</span><span class="n">ipython</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">R</span> <span class="o">-</span><span class="n">i</span> <span class="n">df</span> <span class="o">-</span><span class="n">w</span> <span class="mi">6</span> <span class="o">-</span><span class="n">h</span> <span class="mi">4</span> <span class="o">--</span><span class="n">units</span> <span class="n">cm</span> <span class="o">-</span><span class="n">r</span> <span class="mi">200</span>
<span class="c1"># the first line says &#39;import df and make default figure size 5 by 5 inches</span>
<span class="c1"># with resolution 200. You can change the units to px, cm, etc. as you wish.</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cups_of_coffee</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">productivity</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_line</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
</section>
<section id="word-count-analysis-with-widgets">
<span id="word-count-widgets"></span><h3>Word-count analysis with widgets<a class="headerlink" href="#word-count-analysis-with-widgets" title="Link to this heading"></a></h3>
<div class="admonition-word-count-analysis-with-widgets exercise important admonition" id="exercise-7">
<p class="admonition-title">Word-count analysis with widgets</p>
<p>This exercise uses the
<a class="reference external" href="https://github.com/coderefinery/word-count">word-count project</a>
from earlier lessons.</p>
<ol class="arabic">
<li><p>Have a look under the <code class="docutils literal notranslate"><span class="pre">data/</span></code> directory. You will see four .dat files
containing word-count statistics from books. You can try opening one.</p></li>
<li><p>Open the Launcher, and open a new Text File.</p></li>
<li><p>Copy-paste the code below to the text file, and save it to a file
<code class="docutils literal notranslate"><span class="pre">zipf.py</span></code> (note how syntax highlighting gets activated).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_word_counts</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a list of (word, count, percentage) tuples from a file where each</span>
<span class="sd">    line is of the form &quot;word count percentage&quot;. Lines starting with # are</span>
<span class="sd">    ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_fd</span><span class="p">:</span>
    	     <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_fd</span><span class="p">:</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
          	   <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">counts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
    <span class="k">return</span> <span class="n">counts</span>

<span class="k">def</span><span class="w"> </span><span class="nf">top_n_word</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of (word, count, percentage) tuples,</span>
<span class="sd">    return the top n word counts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">limited_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span>
    <span class="n">count_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">count</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">limited_counts</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">count_data</span>

<span class="k">def</span><span class="w"> </span><span class="nf">zipf_analysis</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">load_word_counts</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
    <span class="n">top_n</span> <span class="o">=</span> <span class="n">top_n_word</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">top_n</span>
</pre></div>
</div>
</li>
<li><p>Import the new zipf module, and have a look at the docstring for one
of the functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import zipf
zipf.top_n_word?
</pre></div>
</div>
</li>
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">zipf_analysis()</span></code> function for a processed datafile. Plot the
output, and compare with a 1/N function, using the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">nmax</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zipf</span><span class="o">.</span><span class="n">zipf_analysis</span><span class="p">(</span><span class="s2">&quot;data/isles.dat&quot;</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">z_norm</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">z</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">z_norm</span><span class="p">)</span>
<span class="n">inv_n</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="o">/</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">inv_n</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add an interactive widget to analyze Zipf’s law, using for example this
code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">interact</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">nmax</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nd">@interact</span><span class="p">(</span><span class="n">p</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">zipf_plot</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;data/isles.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;data/last.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;data/abyss.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;data/sierra.dat&quot;</span><span class="p">]:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">zipf</span><span class="o">.</span><span class="n">zipf_analysis</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>
        <span class="n">z_norm</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">z</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">z_norm</span><span class="p">)</span>
    <span class="n">inv_n</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="n">p</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">inv_n</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add another widget parameter <code class="docutils literal notranslate"><span class="pre">nmax</span></code> to the above code to control the
number of words displayed on the x-axis, e.g. <code class="docutils literal notranslate"><span class="pre">nmax=(6,14)</span></code>, and play
around with both sliders.</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-7">
<p class="admonition-title">Solution</p>
<p>Code for a widget with sliding bars for both number of words and the inverse power:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">interact</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="nd">@interact</span><span class="p">(</span><span class="n">nmax</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">14</span><span class="p">),</span> <span class="n">p</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">zipf_plot</span><span class="p">(</span><span class="n">nmax</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="c1">#plt.figure()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;data/isles.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;data/last.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;data/abyss.dat&quot;</span><span class="p">,</span>
              <span class="s2">&quot;data/sierra.dat&quot;</span><span class="p">]:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">zipf</span><span class="o">.</span><span class="n">zipf_analysis</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>
        <span class="n">z_norm</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">z</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">z_norm</span><span class="p">)</span>
    <span class="n">inv_n</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="n">p</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">inv_n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-exercises"></span><section id="list-of-exercises">
<h2>List of exercises<a class="headerlink" href="#list-of-exercises" title="Link to this heading"></a></h2>
<section id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Link to this heading"></a></h3>
<p>JupyterLab and notebook interface:</p>
<ul class="simple">
<li><p><a class="reference internal" href="index.html#integrated-development-environments"><span class="std std-ref">Tools for writing, testing and debugging code</span></a></p></li>
</ul>
<p>A first computational notebook:</p>
<ul class="simple">
<li><p><a class="reference internal" href="index.html#first-notebook"><span class="std std-ref">An example computational notebook</span></a></p></li>
<li><p><a class="reference internal" href="index.html#other-kernels"><span class="std std-ref">Notebooks in other languages</span></a></p></li>
</ul>
<p>Notebooks and version control:</p>
<ul class="simple">
<li><p><span class="xref std std-ref">plain-git-diff</span></p></li>
</ul>
<p>Sharing notebooks:</p>
<ul class="simple">
<li><p><a class="reference internal" href="index.html#reproducible-via-binder"><span class="std std-ref">Sharing dynamic notebooks on Binder</span></a></p></li>
<li><p><a class="reference internal" href="index.html#without-requirements"><span class="std std-ref">Importance of tracking dependencies</span></a></p></li>
<li><p><a class="reference internal" href="index.html#share-widget"><span class="std std-ref">Sharing an interactive notebook on Binder</span></a></p></li>
</ul>
<p>Examples of Jupyter features:</p>
<ul class="simple">
<li><p><a class="reference internal" href="index.html#interactive-data-fitting"><span class="std std-ref">Widgets for interactive data fitting</span></a></p></li>
<li><p><a class="reference internal" href="index.html#cell-profiling"><span class="std std-ref">Cell profiling</span></a></p></li>
<li><p><a class="reference internal" href="index.html#installing-magic-command"><span class="std std-ref">Installing a magic command for line profiling</span></a></p></li>
<li><p><a class="reference internal" href="index.html#data-analysis"><span class="std std-ref">Data analysis with pandas dataframes</span></a></p></li>
<li><p><a class="reference internal" href="index.html#own-magic-command"><span class="std std-ref">Defining your own custom magic command</span></a></p></li>
<li><p><a class="reference internal" href="index.html#ipyparallel"><span class="std std-ref">Parallel Python with ipyparallel</span></a></p></li>
<li><p><a class="reference internal" href="index.html#mixing-python-r"><span class="std std-ref">Mixing Python and R</span></a></p></li>
<li><p><a class="reference internal" href="index.html#word-count-widgets"><span class="std std-ref">Word-count analysis with widgets</span></a></p></li>
</ul>
</section>
<section id="full-list">
<h3>Full list<a class="headerlink" href="#full-list" title="Link to this heading"></a></h3>
<p>This is a list of all exercises and solutions in this lesson, mainly
as a reference for helpers and instructors.  This list is
automatically generated from all of the other pages in the lesson.
Any single teaching event will probably cover only a subset of these,
depending on their interests.</p>
</section>
</section>
<span id="document-guide"></span><section id="instructor-guide">
<h2>Instructor guide<a class="headerlink" href="#instructor-guide" title="Link to this heading"></a></h2>
<section id="why-we-teach-this-lesson">
<h3>Why we teach this lesson<a class="headerlink" href="#why-we-teach-this-lesson" title="Link to this heading"></a></h3>
<p>When CodeRefinery started teaching this lesson it was meant to introduce participants
to a cool new tool around which there was a lot of buzz (particularly in data science),
and which could be useful to researchers to quickly prototype code and analyze data in an interactive way.
Since then, more and more participants are already using Jupyter for various purposes
when they come to a workshop.</p>
<p>One purpose of teaching this lesson is still to introduce Jupyter to participants who haven’t
used it before. The episodes “Motivation”, “The JupyterLab and notebook interface” and
“A first computational notebook” are meant to inspire participants to use notebooks for
certain appropriate tasks, highlighting in particular the “computational narrative” aspect
which is brilliantly enabled by notebooks.</p>
<p>After the first three episodes the focus shifts to topics related to version control (“Notebooks and version control”), open science and reproducibility (“Sharing notebooks”) which connects to topics covered in other CodeRefinery lessons.</p>
<p>There are also two optional episodes, “Shell commands, magics and widgets” and “Additional exercises”
which go through various features and use-cases of Jupyter.</p>
<p>A key take-home message from this lesson should be that Jupyter notebooks
can be a very useful tool for reproducible research, if used wisely.</p>
</section>
<section id="intended-learning-outcomes">
<h3>Intended learning outcomes<a class="headerlink" href="#intended-learning-outcomes" title="Link to this heading"></a></h3>
<p>By the end of this lesson, learners should:</p>
<ul class="simple">
<li><p>be able to explain what a computational narrative is</p></li>
<li><p>be able to identify areas of their own work where Jupyter notebooks could be an appropriate tool</p></li>
<li><p>be able to use the JupyterLab interface efficiently</p></li>
<li><p>understand that version control is equally important for notebooks as for other code</p></li>
<li><p>know how to version control notebooks efficiently using JupyterLab plugins</p></li>
<li><p>know that notebooks can be used to document scientific analysis, and published
e.g. as supplementary information with journal articles to aid reproducibility</p></li>
<li><p>know how to share notebooks via Binder</p></li>
<li><p>understand possible pitfalls of using notebooks</p></li>
</ul>
</section>
<section id="timing-and-lesson-placement">
<h3>Timing and lesson placement<a class="headerlink" href="#timing-and-lesson-placement" title="Link to this heading"></a></h3>
<section id="detailed-schedule">
<h4>Detailed schedule<a class="headerlink" href="#detailed-schedule" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>12:00 - 12:05 <a class="reference external" href="https://coderefinery.github.io/jupyter/motivation/">Jupyter notebooks</a></p></li>
<li><p>12:05 - 12:15 <a class="reference external" href="https://coderefinery.github.io/jupyter/interface/">JupyterLab and notebook interface</a></p></li>
<li><p>12:15 - 12:40 <a class="reference external" href="https://coderefinery.github.io/jupyter/first-notebook/">A first computational notebook</a></p>
<ul>
<li><p><a class="reference external" href="https://coderefinery.github.io/jupyter/first-notebook/#an-example-computational-notebook">Exercise (20 min)</a></p></li>
</ul>
</li>
<li><p>12:40 - 12:50 <a class="reference external" href="https://coderefinery.github.io/jupyter/version-control/">Notebooks and version control demo</a></p></li>
<li><p>12:50 - 12:55 <a class="reference external" href="https://coderefinery.github.io/jupyter/sharing/">Sharing notebooks</a></p></li>
<li><p>12:55 - 13:05 Break</p></li>
<li><p>13:05 - 13:25 <a class="reference external" href="https://coderefinery.github.io/jupyter/sharing/#sharing-dynamic-notebooks-on-binder">Binder exercise (20 min)</a></p></li>
<li><p>13:25 - 13:30 <a class="reference external" href="https://coderefinery.github.io/jupyter/summary/">Summary</a></p></li>
</ul>
</section>
</section>
<section id="exercises">
<h3>Exercises<a class="headerlink" href="#exercises" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>“A first computational notebook” can be done either as a 20 minute exercise
or as a type-along demo.</p></li>
<li><p>“Instructor demonstrates a plain git diff” should be done as demonstration.</p></li>
<li><p>“Making your notebooks reproducible by anyone via Binder” should be done as a
20 minute exercise but can also be done as a demo.</p></li>
<li><p>There are three optional exercises in “Sharing notebooks”, one on trying to reproduce
results from a published notebook, another on sharing an interactive notebook on Binder,
and one for R users who can try to deploy R   Studio/ R Markdown to Binder.</p></li>
<li><p>The “Examples” episode contains many interesting examples which can be used
for demonstration or as exercises. The dependencies for ipywidget examples are
typically tricky to install/enable in a group exercise. Instead they can be
demonstrated on Binder (there is an optional exercise for this).</p></li>
</ul>
</section>
<section id="how-to-teach-this-lesson">
<h3>How to teach this lesson<a class="headerlink" href="#how-to-teach-this-lesson" title="Link to this heading"></a></h3>
<section id="motivation">
<h4>Motivation<a class="headerlink" href="#motivation" title="Link to this heading"></a></h4>
<p>How the instructor introduces and motivates Jupyter notebooks is flexible and
can depend on the instructor’s background. The first episode emphasizes the
“computational narrative” aspect of notebooks, and highlights a few
common use cases. The gravitational-wave discovery is used as a motivational
example, and it’s helpful if the instructor clicks the Binder link to see how
the notebooks become available for interactive exploration in the cloud.
The instructor should also open the link “Gallery of interesting Jupyter notebooks”
to show the wide variety of notebooks that people have shared online.</p>
</section>
<section id="the-jupyterlab-interface">
<h4>The JupyterLab interface<a class="headerlink" href="#the-jupyterlab-interface" title="Link to this heading"></a></h4>
<p>The second episode deals with the JupyterLab interface and how notebooks work. At
this stage the instructor should open Jupyter-Lab, demonstrate the
interface by clicking around and then launch a new notebook. Inside this notebook
the instructor can add headings and text and a simple code cell to illustrate
how cells work (copy-pasting from the lesson works well). A few important keyboard
shortcuts can be demonstrated.</p>
<p>There is a discussion point on integrated development environments. This can
be used as a discussion exercise, where participants are invited to talk about
their prefered way to write code. The instructur can mention that JupyterLab is
sort of like an IDE for notebooks.</p>
<p>Take-home messages:</p>
<ul class="simple">
<li><p>The JupyterLab interface is flexible and one can customize the workspace by dragging
notebooks, terminals and text editors around.</p></li>
<li><p>There are code cells and markdown cells that work differently, and there are
command and edit modes. It’s easy to switch between these.</p></li>
</ul>
</section>
<section id="a-first-computational-notebook">
<h4>A first computational notebook<a class="headerlink" href="#a-first-computational-notebook" title="Link to this heading"></a></h4>
<p>To show that Jupyter Notebooks are rather simple and intuitive, the third episode
demonstrates the building up of a computational narrative
to compute pi and adding comments, equations and figures.
The instructor should create a new notebook, name it and then type out or copy-paste from the lesson
into notebook cells. Learners should be given time to follow along interactively.</p>
<p>After the notebook is completed, participants and instructor should commit it to the
repository.</p>
<p>Take-home messages:</p>
<ul class="simple">
<li><p>Notebooks provide a simple and interactive tool for various kinds of analysis.</p></li>
<li><p>Keyboard shortcuts enable efficient usage. The instructor should clearly
explain the most common ones for executing cells, creating new cells, changing
between markdown and code cells, etc.</p></li>
<li><p>The execution order of cells matters, the instructor can demonstrate this by
going up and down in the notebook.</p></li>
</ul>
</section>
<section id="notebooks-and-version-control">
<h4>Notebooks and version control<a class="headerlink" href="#notebooks-and-version-control" title="Link to this heading"></a></h4>
<p>After discussing the Git integrations, the instructor should encourage participants to
initialize a Git repo in their notebook directory, and commit the first “testing” notebook.
They can do this via the JupyterLab interface if they have the plugins installed, or via
terminal inside JupyterLab, or via regular terminal.</p>
<p>Take home message: The Git integration in JupyterLab is powerful and enables tracking
notebooks in just the same way as one would with source code files.</p>
</section>
<section id="sharing-notebooks">
<h4>Sharing notebooks<a class="headerlink" href="#sharing-notebooks" title="Link to this heading"></a></h4>
<p>This episode has a list of services and tools to share and collaborate on Jupyter
notebooks. The instructor doesn’t have to go through each item in the list, but
rather emphasize that many services and tools built around Jupyter exist.</p>
<p>The exercise on making notebooks reproducible via Binder is an important one as
it connects with other lessons and emphasizes the reproducibility benefits of notebooks.
If time allows, the instructor can let participants set up a remote repository on GitHub
for their local notebook repos, and push to the remote. After that they can follow the
exercise steps to obtain a Binder badge to add to their repository README files.
If time is short, the instructor can instead just demonstrate all steps and encourage
participants to try it out themselves later.</p>
</section>
<section id="optional-shell-commands-magics-and-widgets">
<h4>(Optional) Shell commands, magics and widgets<a class="headerlink" href="#optional-shell-commands-magics-and-widgets" title="Link to this heading"></a></h4>
<p>Take-home messages:</p>
<ul class="simple">
<li><p>There is more to notebooks than just code.</p></li>
<li><p>Magics and shell commands can be useful for various kinds of workflows, and enable
users to stay within the notebook instead of jumping to another terminal.</p></li>
<li><p>Widgets add even more interactivity to notebooks.</p></li>
</ul>
</section>
<section id="optional-additional-exercises">
<h4>(Optional) Additional exercises<a class="headerlink" href="#optional-additional-exercises" title="Link to this heading"></a></h4>
<p>Interesting and fun exercises to learn about various Jupyter features and use cases.</p>
</section>
</section>
</section>
<span id="document-license"></span><section id="credit-and-license">
<h2>Credit and license<a class="headerlink" href="#credit-and-license" title="Link to this heading"></a></h2>
<p>This material is provided by CodeRefinery under the licenses stated below.</p>
<section id="website-template">
<h3>Website template<a class="headerlink" href="#website-template" title="Link to this heading"></a></h3>
<p>The website template is maintained by <a class="reference external" href="https://coderefinery.org/">CodeRefinery</a>
and rendered with <a class="reference external" href="https://coderefinery.github.io/sphinx-lesson/">sphinx-lesson: structured lessons with Sphinx</a>.</p>
</section>
<section id="instructional-material">
<h3>Instructional material<a class="headerlink" href="#instructional-material" title="Link to this heading"></a></h3>
<p>All CodeRefinery instructional material is made available under the
<a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution license (CC-BY-4.0)</a>.
The following is a human-readable summary of (and not a substitute for)
the <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/legalcode">full legal text of the CC-BY-4.0 license</a>.</p>
<p>You are free:</p>
<ul class="simple">
<li><p>to <strong>Share</strong> - copy and redistribute the material in any medium or format</p></li>
<li><p>to <strong>Adapt</strong> - remix, transform, and build upon the material</p></li>
</ul>
<p>for any purpose, even commercially. The licensor cannot revoke these freedoms as long as you follow these license terms:</p>
<ul class="simple">
<li><p><strong>Attribution</strong> - You must give appropriate credit
(mentioning that your work is derived from work that is Copyright
(c) CodeRefinery and, where practical, linking to
<a class="reference external" href="https://coderefinery.org">https://coderefinery.org</a>, provide
a <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">link to the license</a>,
and indicate if changes were made. You may do so in any
reasonable manner, but not in any way that suggests the licensor
endorses you or your use.</p></li>
</ul>
<p><strong>No additional restrictions</strong> - You may not apply legal terms or technological
measures that legally restrict others from doing anything the license permits.
With the understanding that:</p>
<ul class="simple">
<li><p>You do not have to comply with the license for elements of the material in
the public domain or where your use is permitted by an applicable exception
or limitation.</p></li>
<li><p>No warranties are given. The license may not give you all of the
permissions necessary for your intended use. For example, other
rights such as publicity, privacy, or moral rights may limit how
you use the material.</p></li>
</ul>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright CodeRefinery contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>