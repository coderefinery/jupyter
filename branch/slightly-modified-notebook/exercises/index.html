<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>List of exercises &mdash; Jupyter notebooks  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_lesson.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/coderefinery.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/minipres.js"></script>
        <script src="../_static/tabs.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Instructor guide" href="../guide/" />
    <link rel="prev" title="Examples of Jupyter features" href="../examples/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Jupyter notebooks
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Core episodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../motivation/">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interface/">JupyterLab and notebook interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-notebook/">A first computational notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../version-control/">Notebooks and version control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sharing/">Sharing notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../summary/">Summary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Optional episodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../extra-features/">Shell commands, magics and widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/">Examples of Jupyter features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">List of exercises</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="#full-list">Full list</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license/">Credit and license</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/lessons/core/">All lessons</a></li>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/">CodeRefinery</a></li>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/lessons/reusing/">Reusing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Jupyter notebooks</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">List of exercises</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/coderefinery/jupyter/blob/main/content/exercises.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="list-of-exercises">
<h1>List of exercises<a class="headerlink" href="#list-of-exercises" title="Permalink to this heading"></a></h1>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading"></a></h2>
<p>JupyterLab and notebook interface:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../interface/#integrated-development-environments"><span class="std std-ref">Tools for writing, testing and debugging code</span></a></p></li>
</ul>
<p>A first computational notebook:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../first-notebook/#first-notebook"><span class="std std-ref">An example computational notebook</span></a></p></li>
<li><p><a class="reference internal" href="../first-notebook/#other-kernels"><span class="std std-ref">Notebooks in other languages</span></a></p></li>
</ul>
<p>Notebooks and version control:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../version-control/#plain-git-diff"><span class="std std-ref">A plain git diff</span></a></p></li>
</ul>
<p>Sharing notebooks:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../sharing/#reproducible-via-binder"><span class="std std-ref">Sharing dynamic notebooks on Binder</span></a></p></li>
<li><p><a class="reference internal" href="../sharing/#without-requirements"><span class="std std-ref">Importance of tracking dependencies</span></a></p></li>
<li><p><a class="reference internal" href="../sharing/#share-widget"><span class="std std-ref">Sharing an interactive notebook on Binder</span></a></p></li>
</ul>
<p>Examples of Jupyter features:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../examples/#interactive-data-fitting"><span class="std std-ref">Widgets for interactive data fitting</span></a></p></li>
<li><p><a class="reference internal" href="../examples/#cell-profiling"><span class="std std-ref">Cell profiling</span></a></p></li>
<li><p><a class="reference internal" href="../examples/#installing-magic-command"><span class="std std-ref">Installing a magic command for line profiling</span></a></p></li>
<li><p><a class="reference internal" href="../examples/#data-analysis"><span class="std std-ref">Data analysis with pandas dataframes</span></a></p></li>
<li><p><a class="reference internal" href="../examples/#own-magic-command"><span class="std std-ref">Defining your own custom magic command</span></a></p></li>
<li><p><a class="reference internal" href="../examples/#ipyparallel"><span class="std std-ref">Parallel Python with ipyparallel</span></a></p></li>
<li><p><a class="reference internal" href="../examples/#mixing-python-r"><span class="std std-ref">Mixing Python and R</span></a></p></li>
<li><p><a class="reference internal" href="../examples/#word-count-widgets"><span class="std std-ref">Word-count analysis with widgets</span></a></p></li>
</ul>
</section>
<section id="full-list">
<h2>Full list<a class="headerlink" href="#full-list" title="Permalink to this heading"></a></h2>
<p>This is a list of all exercises and solutions in this lesson, mainly
as a reference for helpers and instructors.  This list is
automatically generated from all of the other pages in the lesson.
Any single teaching event will probably cover only a subset of these,
depending on their interests.</p>
<section id="a-first-computational-notebook">
<h3>A first computational notebook<a class="headerlink" href="#a-first-computational-notebook" title="Permalink to this heading"></a></h3>
<p><a class="reference external" href="../first-notebook/#exercise-0">In first-notebook.md:</a></p>
<div class="admonition-exercise-demonstration-calculating-pi-using-monte-carlo-methods exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise/demonstration: Calculating pi using Monte Carlo methods</p>
<p>This can be either done as a 20 minute exercise or as a type-along demo.</p>
<p>Each numbered item will be a new cell. Press SHIFT+ENTER to run a cell and create
a new cell below. With the cell selected, press ESCAPE to go into command mode. Use shortcuts <code class="docutils literal notranslate"><span class="pre">M</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code> to change cells to markdown and code, respectively.</p>
<ol class="arabic">
<li><p>Create a new notebook, name it, and add a heading (markdown cell).</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gh"># Calculating pi using Monte Carlo methods</span>
</pre></div>
</div>
</li>
<li><p>Document the relevant formulas in a new cell (markdown cell):</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gu">## Relevant formulas</span>

<span class="k">-</span><span class="w"> </span>square area: $s = (2 r)^2$
<span class="k">-</span><span class="w"> </span>circle area: $c = \pi r^2$
<span class="k">-</span><span class="w"> </span>$c/s = (\pi r^2) / (4 r^2) = \pi / 4$
<span class="k">-</span><span class="w"> </span>$\pi = 4 * c/s$
</pre></div>
</div>
</li>
<li><p>Add an image to explain the concept (markdown cell):</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gu">## Image to visualize the concept</span>

![<span class="nt">Darts</span>](<span class="na">https://raw.githubusercontent.com/coderefinery/jupyter/main/example/darts.svg</span>)
</pre></div>
</div>
</li>
<li><p>Import two modules that we will need (code cell):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># importing modules that we will need</span>

<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</li>
<li><p>Initialize the number of points (code cell):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># initializing the number of &quot;throws&quot;</span>

<span class="n">num_points</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
</li>
<li><p>“Throw darts” (code cell):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># here we &quot;throw darts&quot; and count the number of hits</span>

<span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">hits</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>Plot results (code cell):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># unzip points into 3 lists</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">)</span>

<span class="c1"># define figure dimensions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span>

<span class="c1"># plot results</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Compute the estimate for pi (code cell):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute and print the estimate</span>

<span class="n">fraction</span> <span class="o">=</span> <span class="n">hits</span> <span class="o">/</span> <span class="n">num_points</span>
<span class="mi">4</span> <span class="o">*</span> <span class="n">fraction</span>
</pre></div>
</div>
</li>
</ol>
</div>
</section>
<section id="notebooks-and-version-control">
<h3>Notebooks and version control<a class="headerlink" href="#notebooks-and-version-control" title="Permalink to this heading"></a></h3>
<p><a class="reference external" href="../version-control/#exercise-0">In version-control.md:</a></p>
<div class="admonition-instructor-demonstrates-a-plain-git-diff exercise important admonition" id="exercise-0">
<p class="admonition-title">Instructor demonstrates a plain git diff</p>
<ol class="arabic simple">
<li><p>To understand the problem, the instructor first shows the <a class="reference external" href="https://github.com/coderefinery/jupyter/blob/main/example/darts.ipynb">example
notebook</a>
and then the <a class="reference external" href="https://raw.githubusercontent.com/coderefinery/jupyter/main/example/darts.ipynb">source
code</a>
in JSON format.</p></li>
<li><p>Then we introduce a simple change to the example notebook, for instance
changing colors (change “red” and “blue” to something else)
and also changing dimensions in <code class="docutils literal notranslate"><span class="pre">fig.set_size_inches(6.0,</span> <span class="pre">6.0)</span></code>.</p></li>
<li><p>Run all cells.</p></li>
<li><p>We save the change (save icon) and in the JupyterLab terminal try a “normal” <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code>
and see that this is not very useful. Discuss why.</p></li>
</ol>
</div>
</section>
<section id="sharing-notebooks">
<h3>Sharing notebooks<a class="headerlink" href="#sharing-notebooks" title="Permalink to this heading"></a></h3>
<p><a class="reference external" href="../sharing/#exercise-0">In sharing.md:</a></p>
<div class="admonition-exercise-20-min-making-your-notebooks-reproducible-by-anyone-via-binder exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise (20 min): Making your notebooks reproducible by anyone via Binder</p>
<ul>
<li><p>Create a new GitHub repository and <strong>click on “Add a README file”</strong>: <a class="reference external" href="https://github.com/new">https://github.com/new</a></p></li>
<li><p>This exercise can be done entirely through the GitHub web interface (but
using the terminal is of course also OK). You can use the “Add file” button
to upload files:</p>
<figure class="align-default" id="id1">
<img alt="Screenshot of Binder web interface" src="../_images/github-upload.png" />
<figcaption>
<p><span class="caption-text">Screenshot of Binder web interface.</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-SnVweXRlciBOb3RlYm9va3M=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-SnVweXRlciBOb3RlYm9va3M=" name="SnVweXRlciBOb3RlYm9va3M=" role="tab" tabindex="0">Jupyter Notebooks</button><button aria-controls="panel-0-UiBNYXJrZG93bi9SIFN0dWRpbyBwcm9qZWN0" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-UiBNYXJrZG93bi9SIFN0dWRpbyBwcm9qZWN0" name="UiBNYXJrZG93bi9SIFN0dWRpbyBwcm9qZWN0" role="tab" tabindex="-1">R Markdown/R Studio project</button></div><div aria-labelledby="tab-0-SnVweXRlciBOb3RlYm9va3M=" class="sphinx-tabs-panel group-tab" id="panel-0-SnVweXRlciBOb3RlYm9va3M=" name="SnVweXRlciBOb3RlYm9va3M=" role="tabpanel" tabindex="0"><ul>
<li><p>Upload the notebook which we have created earlier to this repository. If you got stuck earlier,
you can download <a class="reference external" href="https://raw.githubusercontent.com/coderefinery/jupyter/main/example/darts.ipynb">this notebook</a>
(right-click, “Save as …”). You can also try this with a different notebook.</p></li>
<li><p>Add also a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file which contains (adapt this if your notebook has other dependencies):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matplotlib</span><span class="o">==</span><span class="mf">3.4.1</span>
</pre></div>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-0-UiBNYXJrZG93bi9SIFN0dWRpbyBwcm9qZWN0" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-UiBNYXJrZG93bi9SIFN0dWRpbyBwcm9qZWN0" name="UiBNYXJrZG93bi9SIFN0dWRpbyBwcm9qZWN0" role="tabpanel" tabindex="0"><p>This exercise is for those who use Rmd files instead of Jupyter notebooks.</p>
<ul>
<li><p>Upload or push your Rmd file to this GitHub repository.</p></li>
<li><p>Add a file <code class="docutils literal notranslate"><span class="pre">runtime.txt</span></code> which specifies the R version you want to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="o">-</span><span class="mf">3.6</span><span class="o">-</span><span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">13</span>
</pre></div>
</div>
</li>
<li><p>Add a file <code class="docutils literal notranslate"><span class="pre">install.R</span></code> which lists the dependencies, for instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">install</span><span class="o">.</span><span class="n">packages</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;readr&quot;</span><span class="p">,</span> <span class="s2">&quot;ggplot2&quot;</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>After you have done that, visit
https://mybinder.org/v2/gh/<strong>USER</strong>/<strong>REPOSITORY</strong>/<strong>BRANCH</strong>?urlpath=rstudio (adapt
“USER”, “REPOSITORY”, and “BRANCH”).</p></li>
<li><p>For more information, see <a class="reference external" href="https://github.com/alan-turing-institute/the-turing-way/blob/master/workshops/boost-research-reproducibility-binder/workshop-presentations/zero-to-binder-r.md">this
guide</a>.</p></li>
</ul>
</div></div>
<ul>
<li><p>Visit <a class="reference external" href="https://mybinder.org">https://mybinder.org</a>:</p>
<figure class="align-default" id="id2">
<img alt="Screenshot of Binder web interface" src="../_images/binder.jpg" />
<figcaption>
<p><span class="caption-text">Screenshot of Binder web interface.</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</li>
<li><p>Copy-paste the markdown text for the mybinder badge into a README.md file in your notebook repository.</p></li>
<li><p>Check that your notebook repository now has a “launch binder”
badge in your <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file on GitHub.</p></li>
<li><p>Try clicking the button and see how your repository is launched
on Binder (can take a minute or two). Your notebooks can now be expored and executed in the cloud.</p></li>
<li><p>Enjoy being fully reproducible! Even better would be to get a DOI to your
notebook and point Binder to the DOI.</p></li>
</ul>
</div>
<p><a class="reference external" href="../sharing/#exercise-1">In sharing.md:</a></p>
<div class="admonition-optional-exercise-what-happens-without-requirements-txt exercise important admonition" id="exercise-1">
<p class="admonition-title">(Optional) Exercise: what happens without requirements.txt?</p>
<p>Let’s look at the same <a class="reference external" href="https://github.com/timalthoff/activityinequality">activity inequality
repository</a>.</p>
<ul>
<li><p>Start the repository in Binder <a class="reference external" href="https://mybinder.org/v2/gh/timalthoff/activityinequality/master">using this link</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fig3/fig3bc.ipynb</span></code> is a Python notebook, so it works in Binder.
Most others are in R, which also works in Binder. <a class="reference external" href="https://mybinder.readthedocs.io/en/latest/howto/languages.html">But
how?</a></p></li>
<li><p>Try to run the notebook. What happens?</p></li>
<li><p>Most likely the run breaks down immediately in the first cell:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">cycle</span>
</pre></div>
</div>
<p>We get a long list of <code class="docutils literal notranslate"><span class="pre">ModuleNotFoundError</span></code> messages. This is
because the required Python packages have not been installed and can not be imported.
The missing packages include, at least, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> mentioned in the
error message.</p>
</li>
<li><p>To install the missing requirements, add a new code cell to the beginning of the
notebook with the contents</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!python3 -m pip install pandas matplotlib
</pre></div>
</div>
<p>and run the notebook again. What happens now?</p>
</li>
<li><p>Again, the run breaks due to missing packages. This time the culprit is the
<code class="docutils literal notranslate"><span class="pre">seaborn</span></code> package. Modify the first cell to also install it with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!python3 -m pip install pandas matplotlib seaborn
</pre></div>
</div>
<p>and try to run the notebook for the third time. Does it finally work?
What could have been done differently by the developer?</p>
</li>
<li><p>A good way to make a notebook more usable is to create a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file
containing the necessary packages to run the notebook and add it next to the notebook
in the repository.</p></li>
<li><p>In this case, the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> could look like this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pandas</span>
<span class="n">matplotlib</span>
<span class="n">seaborn</span>
</pre></div>
</div>
<p>and to make sure the packages are installed, one could add a code cell to the beginning
of original notebook with the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!python3 -m pip install -r requirements.txt
</pre></div>
</div>
<p>To make sure that the notebook will continue to work also in few months,
you might want to specify also the version in the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file.</p>
</li>
</ul>
</div>
<p><a class="reference external" href="../sharing/#exercise-2">In sharing.md:</a></p>
<div class="admonition-optional-exercise-share-an-interactive-ipywidgets-notebook-via-binder exercise important admonition" id="exercise-2">
<p class="admonition-title">(Optional) Exercise: share an interactive (ipywidgets) notebook via Binder</p>
<ul>
<li><p>Take the solution from the exercise “Widgets for interactive data fitting” in the <a class="reference internal" href="../examples/"><span class="doc">Examples of Jupyter features</span></a>
episode and paste it into a notebook.</p></li>
<li><p>Push the notebook to a GitHub/GitLab repository.</p></li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file in your notebook repository, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipywidgets</span><span class="o">==</span><span class="mf">7.4.2</span>
<span class="n">numpy</span><span class="o">==</span><span class="mf">1.16.4</span>
<span class="n">matplotlib</span><span class="o">==</span><span class="mf">3.1.0</span>
</pre></div>
</div>
</li>
<li><p>Try to deploy this example via Binder in the same way as the above exercise.</p></li>
</ul>
</div>
</section>
<section id="shell-commands-magics-and-widgets">
<h3>Shell commands, magics and widgets<a class="headerlink" href="#shell-commands-magics-and-widgets" title="Permalink to this heading"></a></h3>
<p><a class="reference external" href="../extra-features/#exercise-0">In extra-features.md:</a></p>
<div class="admonition-a-few-useful-magic-commands exercise important admonition" id="exercise-0">
<p class="admonition-title">A few useful magic commands</p>
<p>Using the computing-pi notebook, practice using a few magic commands.
Remember that cell magics need to be on the first line of the cell.</p>
<ol class="arabic simple">
<li><p>In the cell with the for-loop over <code class="docutils literal notranslate"><span class="pre">num_points</span></code> (throwing darts), add the
<code class="docutils literal notranslate"><span class="pre">%%timeit</span></code> cell magic and run the cell.</p></li>
<li><p>In the same cell, try instead the <code class="docutils literal notranslate"><span class="pre">%%prun</span></code> cell profiling magic.</p></li>
<li><p>Try introducing a bug in the code (e.g., use an incorrect variable name:
<code class="docutils literal notranslate"><span class="pre">points.append((x,</span> <span class="pre">y2,</span> <span class="pre">True))</span></code>)</p>
<ul class="simple">
<li><p>run the cell</p></li>
<li><p>after the exception occurs, run the <code class="docutils literal notranslate"><span class="pre">%debug</span></code> magic in a new cell
to enter an interactive debugger</p></li>
<li><p>type <code class="docutils literal notranslate"><span class="pre">h</span></code> for a help menu, and <code class="docutils literal notranslate"><span class="pre">help</span> <span class="pre">&lt;keyword&gt;</span></code> for help on keyword</p></li>
<li><p>type <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">x</span></code> to print the value of <code class="docutils literal notranslate"><span class="pre">x</span></code></p></li>
<li><p>exit the debugger by typing <code class="docutils literal notranslate"><span class="pre">q</span></code></p></li>
</ul>
</li>
<li><p>Have a look at the output of <code class="docutils literal notranslate"><span class="pre">%lsmagic</span></code>, and use a question mark and
double question mark to see help for a magic command that raises
your interest.</p></li>
</ol>
</div>
<p><a class="reference external" href="../extra-features/#exercise-1">In extra-features.md:</a></p>
<div class="admonition-playing-around-with-a-widget exercise important admonition" id="exercise-1">
<p class="admonition-title">Playing around with a widget</p>
<p>Widgets can be used to interactively explore or analyze data.</p>
<ol class="arabic">
<li><p>We return to the pi approximation example and create a new cell where
we reuse code that we have written earlier but this time we place the
code into functions. This “hides” details and allows us to reuse the functions
later or in other notebooks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">widgets</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>


<span class="k">def</span> <span class="nf">throw_darts</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
    <span class="n">fraction</span> <span class="o">=</span> <span class="n">hits</span> <span class="o">/</span> <span class="n">num_points</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">fraction</span>
    <span class="k">return</span> <span class="n">pi</span><span class="p">,</span> <span class="n">points</span>


<span class="k">def</span> <span class="nf">create_plot</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">experiment</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
    <span class="n">pi</span><span class="p">,</span> <span class="n">points</span> <span class="o">=</span> <span class="n">throw_darts</span><span class="p">(</span><span class="n">num_points</span><span class="p">)</span>
    <span class="n">create_plot</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;approximation:&quot;</span><span class="p">,</span> <span class="n">pi</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Try to call the <code class="docutils literal notranslate"><span class="pre">experiment</span></code> function with e.g. <code class="docutils literal notranslate"><span class="pre">num_points</span></code> set to 2000.</p></li>
<li><p>Add a cell where we will make it possible to vary the number of points interactively:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">interact</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">num_points</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
</pre></div>
</div>
<p>If you run into <code class="docutils literal notranslate"><span class="pre">Error</span> <span class="pre">displaying</span> <span class="pre">widget:</span> <span class="pre">model</span> <span class="pre">not</span> <span class="pre">found</span></code>, you may need to refresh the page.</p>
</li>
<li><p>Drag the slider back and forth and observe the results.</p></li>
<li><p>Can you think of other interesting uses of widgets?</p></li>
</ol>
</div>
</section>
<section id="examples-of-jupyter-features">
<h3>Examples of Jupyter features<a class="headerlink" href="#examples-of-jupyter-features" title="Permalink to this heading"></a></h3>
<p><a class="reference external" href="../examples/#exercise-0">In examples.md:</a></p>
<div class="admonition-widgets-for-interactive-data-fitting exercise important admonition" id="exercise-0">
<p class="admonition-title">Widgets for interactive data fitting</p>
<p>Widgets are fun, but they can also be useful. Here’s an example showing how you can fit noisy data interactively.</p>
<ol class="arabic simple">
<li><p>Execute the cell below. It fits a 5th order polynomial to a gaussian function with some random noise</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">&#64;interact</span></code> decorator around the last two code lines
such that you can visualize fits with polynomial orders <code class="docutils literal notranslate"><span class="pre">n</span></code>
ranging from, say, 3 to 30:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">noisy_gaussian</span><span class="p">():</span>
    <span class="c1"># gaussian array y in interval -5 &lt;= x &lt;= 5</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">+=</span> <span class="n">noise</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">pfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">yfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">pfit</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yfit</span>

<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yfit</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yfit</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Fit&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">noisy_gaussian</span><span class="p">()</span>
<span class="n">yfit</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># fit a 5th order polynomial to it</span>
<span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yfit</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">noisy_gaussian</span><span class="p">():</span>
    <span class="c1"># gaussian array y in interval -5 &lt;= x &lt;= 5</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">+=</span> <span class="n">noise</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">pfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">yfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">pfit</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yfit</span>

<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yfit</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yfit</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Fit&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">noisy_gaussian</span><span class="p">()</span>

<span class="nd">@interact</span>
<span class="k">def</span> <span class="nf">slider</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">30</span><span class="p">)):</span>
    <span class="n">yfit</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yfit</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="../examples/#exercise-1">In examples.md:</a></p>
<div class="admonition-cell-profiling exercise important admonition" id="exercise-1">
<p class="admonition-title">Cell profiling</p>
<p>This exercise is about cell profiling, but you will get practice in
working with magics and cells.</p>
<ol class="arabic">
<li><p>Copy-paste the following code into a cell:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">step</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="k">return</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">.5</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span>

<span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">step</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x_new</span> <span class="o">&gt;</span> <span class="mf">5e-3</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_new</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">walk</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Split up the functions over 4 cells (either via Edit menu or keyboard shortcut <code class="docutils literal notranslate"><span class="pre">Ctrl-Shift-minus</span></code>).</p></li>
<li><p>Plot the random walk trajectory using <code class="docutils literal notranslate"><span class="pre">plt.plot(x)</span></code>.</p></li>
<li><p>Time the execution of <code class="docutils literal notranslate"><span class="pre">walk()</span></code> with a line magic.</p></li>
<li><p>Run the prun cell profiler.</p></li>
<li><p>Can you spot a little mistake which is slowing down the code?</p></li>
<li><p>In the next exercise you will install a line profiler which
will more easily expose the performance mistake.</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<p>Split the code over multiple cells (e.g. using <code class="docutils literal notranslate"><span class="pre">Ctrl-Shift-minus</span></code>)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">step</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="k">return</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">.5</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">step</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x_new</span> <span class="o">&gt;</span> <span class="mf">5e-3</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_new</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>Initialize <code class="docutils literal notranslate"><span class="pre">n</span></code> and call <code class="docutils literal notranslate"><span class="pre">walk()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">walk</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the random walk</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</pre></div>
</div>
<p>Time the execution using the <code class="docutils literal notranslate"><span class="pre">%timeit</span></code> line magic, and capture the output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t1</span> <span class="o">=</span> <span class="o">%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">o</span> <span class="n">walk</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>Best result</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t1</span><span class="o">.</span><span class="n">best</span>
</pre></div>
</div>
<p>Run with the <code class="docutils literal notranslate"><span class="pre">%%prun</span></code> cell profiler</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">prun</span>
<span class="n">walk</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="../examples/#exercise-2">In examples.md:</a></p>
<div class="admonition-installing-a-magic-command-for-line-profiling exercise important admonition" id="exercise-2">
<p class="admonition-title">Installing a magic command for line profiling</p>
<p>Magics can be installed using <code class="docutils literal notranslate"><span class="pre">pip</span></code> and loaded like plugins using the
<code class="docutils literal notranslate"><span class="pre">%load_ext</span></code> magic. You will now install a line-profiler to get more
detailed profile, and hopefully find insight to speed up the code
from the previous exercise.</p>
<ol class="arabic">
<li><p>If you haven’t solved the previous exercise, copy paste the following code into a cell
and run it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">step</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="k">return</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">.5</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span>

<span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">step</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x_new</span> <span class="o">&gt;</span> <span class="mf">5e-3</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_new</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">walk</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Then install the line profiler using <code class="docutils literal notranslate"><span class="pre">!pip</span> <span class="pre">install</span> <span class="pre">line_profiler</span></code>.</p></li>
<li><p>Next load it using <code class="docutils literal notranslate"><span class="pre">%load_ext</span> <span class="pre">line_profiler</span></code>.</p></li>
<li><p>Have a look at the new magic command that has been enabled with <code class="docutils literal notranslate"><span class="pre">%lprun?</span></code></p></li>
<li><p>In a new cell, run the line profiler on the <code class="docutils literal notranslate"><span class="pre">walk</span></code> and <code class="docutils literal notranslate"><span class="pre">step</span></code> functions in the way
described on the help page.</p></li>
<li><p>Inspect the output. Can you more easily see the mistake now?</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solution</p>
<p>Copy-paste the code into a cell</p>
<p>Install the line profiler</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install line_profiler
</pre></div>
</div>
<p>Load the IPython extension</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">line_profiler</span>
</pre></div>
</div>
<p>See help:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%lprun?
</pre></div>
</div>
<p>Use the line profiler on the <code class="docutils literal notranslate"><span class="pre">walk</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">lprun</span> <span class="o">-</span><span class="n">f</span> <span class="n">walk</span> <span class="n">walk</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<p>Aha, most time is spent on the line calling the <code class="docutils literal notranslate"><span class="pre">step()</span></code> function.
Run line profiler on <code class="docutils literal notranslate"><span class="pre">step</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">lprun</span> <span class="o">-</span><span class="n">f</span> <span class="n">step</span> <span class="n">walk</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
     <span class="mi">8</span>                                           <span class="k">def</span> <span class="nf">step</span><span class="p">():</span>
     <span class="mi">9</span>      <span class="mi">9999</span>       <span class="mf">7488.0</span>      <span class="mf">0.7</span>     <span class="mf">52.3</span>      <span class="kn">import</span> <span class="nn">random</span>
    <span class="mi">10</span>      <span class="mi">9999</span>       <span class="mf">6840.0</span>      <span class="mf">0.7</span>     <span class="mf">47.7</span>      <span class="k">return</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Aha! Lot’s of time is spent on importing the <code class="docutils literal notranslate"><span class="pre">random</span></code> module inside the <code class="docutils literal notranslate"><span class="pre">step</span></code> function
which is called thousands of times. Move the import statement to outside the function!</p>
</div>
</div>
<p><a class="reference external" href="../examples/#exercise-3">In examples.md:</a></p>
<div class="admonition-data-analysis-with-pandas-dataframes exercise important admonition" id="exercise-3">
<p class="admonition-title">Data analysis with pandas dataframes</p>
<p>Data science and data analysis are key use cases of Jupyter. In this
exercise you will familiarize yourself with dataframes and various
inbuilt analysis methods in the high-level <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data exploration
library. A dataset containing information on Nobel prizes will be viewed with the file browser.</p>
<ol class="arabic simple">
<li><p>Start by navigating in the File Browser to the <code class="docutils literal notranslate"><span class="pre">data/</span></code> subfolder, and
double-click on the <code class="docutils literal notranslate"><span class="pre">nobels.csv</span></code> dataset. This will open JupyterLab’s
inbuilt data browser.</p></li>
<li><p>Have a look at the data, column names, etc.</p></li>
<li><p>In a your own notebook, import the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> module and load the dataset into a <em>dataframe</em>:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">nobel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/nobels.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>The “share” column of the dataframe contains the number of Nobel recipients that shared the prize. Have a look at the statistics of this column using</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;share&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>The <code class="docutils literal notranslate"><span class="pre">describe()</span></code> method is smart about data types. Try this:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;bornCountryCode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- What country has received the largest number of Nobel prizes, and how many?
- How many countries are represented in the dataset?
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>Now analyze the age of prize recipients. You first need to convert the “born” column to datetime format:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">],</span>
                               <span class="n">errors</span> <span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>Next subtract the birth date from the year of receiving the prize and insert it into a new column “age”:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Now print the “surname” and “age” of first 10 entries using the <code class="docutils literal notranslate"><span class="pre">head()</span></code> method.</p></li>
</ul>
<ol class="arabic simple" start="8">
<li><p>Now plot results in two different ways:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">);</span>
<span class="n">nobel</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="9">
<li><p>Which Nobel laureates have been Swedish? See if you can use the <code class="docutils literal notranslate"><span class="pre">nobel.loc[CONDITION]</span></code> statement to extract the relevant rows from the <code class="docutils literal notranslate"><span class="pre">nobel</span></code> dataframe using the appropriate condition.</p></li>
<li><p>Finally, try the powerful <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> method to analyze the number of Nobel prizes per country, and visualize it with the high-level <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> plotting library.</p></li>
</ol>
<ul class="simple">
<li><p>First add a column “number” to the <code class="docutils literal notranslate"><span class="pre">nobel</span></code> dataframe containing 1’s (to enable the counting below).</p></li>
<li><p>Then extract any 4 countries (replace below) and create a subset of the dataframe:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">countries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">COUNTRY1</span><span class="p">,</span> <span class="n">COUNTRY2</span><span class="p">,</span> <span class="n">COUNTRY3</span><span class="p">,</span> <span class="n">COUNTRY4</span><span class="p">])</span>
<span class="n">nobel2</span> <span class="o">=</span> <span class="n">nobel</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nobel</span><span class="p">[</span><span class="s1">&#39;bornCountry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">countries</span><span class="p">)]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Next use <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> and <code class="docutils literal notranslate"><span class="pre">sum()</span></code>, and inspect the resulting dataframe:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobels_by_country</span> <span class="o">=</span> <span class="n">nobel2</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;bornCountry&#39;</span><span class="p">,</span><span class="s2">&quot;category&quot;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Next use the <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code> method to reshape the dataframe to a spreadsheet-like structure, and display the result:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">nobel2</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Finally visualize using a heatmap:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Have a look at the help page for <code class="docutils literal notranslate"><span class="pre">sns.heatmap</span></code> and see if you can find an
input parameter which annotates each cell in the plot with the count
number.</p></li>
</ul>
<div class="admonition-solution solution important dropdown admonition" id="solution-3">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">nobel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/nobels.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;share&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;bornCountryCode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>USA has received 275 prizes.</p></li>
<li><p>76 countries have received at least one prize.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">],</span> <span class="n">errors</span> <span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Add column</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
</pre></div>
</div>
<p>Print surname and age</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[[</span><span class="s2">&quot;surname&quot;</span><span class="p">,</span><span class="s2">&quot;age&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Which Nobel laureates have been Swedish?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sweden&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Finally, try the powerful <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> method.
Add extra column with number of Nobel prizes per row (needed for statistics)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
<p>Pick a few countries to analyze further</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">countries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;Sweden&quot;</span><span class="p">,</span> <span class="s2">&quot;United Kingdom&quot;</span><span class="p">,</span> <span class="s2">&quot;France&quot;</span><span class="p">,</span> <span class="s2">&quot;Denmark&quot;</span><span class="p">])</span>
<span class="n">nobel2</span> <span class="o">=</span> <span class="n">nobel</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nobel</span><span class="p">[</span><span class="s1">&#39;bornCountry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">countries</span><span class="p">)]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">nobel2</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span>
                           <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
<span class="n">table</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="../examples/#exercise-4">In examples.md:</a></p>
<div class="admonition-defining-your-own-custom-magic-command exercise important admonition" id="exercise-4">
<p class="admonition-title">Defining your own custom magic command</p>
<p>It is possible to create new magic commands using the <code class="docutils literal notranslate"><span class="pre">&#64;register_cell_magic</span></code> decorator from the <code class="docutils literal notranslate"><span class="pre">IPython.core</span></code> library. Here you will create a cell magic command that compiles C++ code and executes it.
This exercise requires that you have the GNU <code class="docutils literal notranslate"><span class="pre">g++</span></code> compiler installed on your computer.</p>
<blockquote>
<div><p>This example has been adapted from the <a class="reference external" href="http://ipython-books.github.io/">IPython Minibook</a>, by Cyrille Rossant, Packt Publishing, 2015.</p>
</div></blockquote>
<ol class="arabic simple">
<li><p>First import <code class="docutils literal notranslate"><span class="pre">register_cell_magic</span></code></p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.magic</span> <span class="kn">import</span> <span class="n">register_cell_magic</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Next copy-paste the following code into a cell, and execute it to
register the new cell magic command:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_cell_magic</span>
<span class="k">def</span> <span class="nf">cpp</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compile, execute C++ code, and return the standard output.&quot;&quot;&quot;</span>

    <span class="c1"># We first retrieve the current IPython interpreter instance.</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>
    <span class="c1"># We define the source and executable filenames.</span>
    <span class="n">source_filename</span> <span class="o">=</span> <span class="s1">&#39;_temp.cpp&#39;</span>
    <span class="n">program_filename</span> <span class="o">=</span> <span class="s1">&#39;_temp&#39;</span>
    <span class="c1"># We write the code to the C++ file.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="c1"># We compile the C++ code into an executable.</span>
    <span class="nb">compile</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s2">&quot;g++ </span><span class="si">{0:s}</span><span class="s2"> -o </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">source_filename</span><span class="p">,</span> <span class="n">program_filename</span><span class="p">))</span>
    <span class="c1"># We execute the executable and return the output.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s1">&#39;./</span><span class="si">{0:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program_filename</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li><p>You can now start using the magic using <code class="docutils literal notranslate"><span class="pre">%%cpp</span></code>.</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>Write some C++ code into a cell and try executing it.</p></li>
<li><p>To be able to use the magic in another notebook, you need to add the
following function at the end and then write the cell to a file in
your PYTHONPATH. If the file is called <code class="docutils literal notranslate"><span class="pre">cpp_ext.py</span></code>, you can then
load it by <code class="docutils literal notranslate"><span class="pre">%load_ext</span> <span class="pre">cpp_ext</span></code>.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_ipython_extension</span><span class="p">(</span><span class="n">ipython</span><span class="p">):</span>
    <span class="n">ipython</span><span class="o">.</span><span class="n">register_magic_function</span><span class="p">(</span><span class="n">cpp</span><span class="p">,</span><span class="s1">&#39;cell&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-4">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.magic</span> <span class="kn">import</span> <span class="n">register_cell_magic</span>
</pre></div>
</div>
<p>Add <code class="docutils literal notranslate"><span class="pre">load_ipython_extension</span></code> function, and write cell to file called <code class="docutils literal notranslate"><span class="pre">cpp_ext.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">cpp_ext</span><span class="o">.</span><span class="n">py</span>
<span class="k">def</span> <span class="nf">cpp</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compile, execute C++ code, and return the standard output.&quot;&quot;&quot;</span>

    <span class="c1"># We first retrieve the current IPython interpreter instance.</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>
    <span class="c1"># We define the source and executable filenames.</span>
    <span class="n">source_filename</span> <span class="o">=</span> <span class="s1">&#39;_temp.cpp&#39;</span>
    <span class="n">program_filename</span> <span class="o">=</span> <span class="s1">&#39;_temp&#39;</span>
    <span class="c1"># We write the code to the C++ file.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="c1"># We compile the C++ code into an executable.</span>
    <span class="nb">compile</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s2">&quot;g++ </span><span class="si">{0:s}</span><span class="s2"> -o </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">source_filename</span><span class="p">,</span> <span class="n">program_filename</span><span class="p">))</span>
    <span class="c1"># We execute the executable and return the output.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s1">&#39;./</span><span class="si">{0:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program_filename</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">load_ipython_extension</span><span class="p">(</span><span class="n">ipython</span><span class="p">):</span>
    <span class="n">ipython</span><span class="o">.</span><span class="n">register_magic_function</span><span class="p">(</span><span class="n">cpp</span><span class="p">,</span><span class="s1">&#39;cell&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Load extension:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">cpp_ext</span>
</pre></div>
</div>
<p>Get help on the cpp magic:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%%cpp?
</pre></div>
</div>
<p>Hello World program in C++</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Hello, World!&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="../examples/#exercise-5">In examples.md:</a></p>
<div class="admonition-parallel-python-with-ipyparallel exercise important admonition" id="exercise-5">
<p class="admonition-title">Parallel Python with ipyparallel</p>
<p>Traditionally, Python is considered to not support parallel programming very
well (<a class="reference external" href="https://en.wikipedia.org/wiki/Global_interpreter_lock">see “GIL”</a>),
and “proper” parallel programming should be left to “heavy-duty” languages
like Fortran or C/C++ where OpenMP and MPI can be utilised.</p>
<p>However, IPython now supports many different styles of parallelism which
can be useful to researchers. In particular, <code class="docutils literal notranslate"><span class="pre">ipyparallel</span></code> enables all
types of parallel applications to be developed, executed, debugged, and
monitored interactively. Possible use cases of <code class="docutils literal notranslate"><span class="pre">ipyparallel</span></code> include:</p>
<ul class="simple">
<li><p>Quickly parallelize algorithms that are embarrassingly parallel using
a number of simple approaches.</p></li>
<li><p>Run a set of tasks on a set of CPUs using dynamic load balancing.</p></li>
<li><p>Develop, test and debug new parallel algorithms (that may use MPI)
interactively.</p></li>
<li><p>Analyze and visualize large datasets (that could be remote and/or
distributed) interactively using IPython</p></li>
</ul>
<p>This exercise is just to get started, for a thorough treatment see the
<a class="reference external" href="https://ipyparallel.readthedocs.io/en/latest/">official documentation</a>
and <a class="reference external" href="https://github.com/DaanVanHauwermeiren/ipyparallel-tutorial">this detailed tutorial</a>.</p>
<ol class="arabic simple">
<li><p>First install <code class="docutils literal notranslate"><span class="pre">ipyparallel</span></code> using <code class="docutils literal notranslate"><span class="pre">conda</span></code> or <code class="docutils literal notranslate"><span class="pre">pip</span></code>. Open a terminal window
inside JupyterLab and do the installation.</p></li>
<li><p>After installing <code class="docutils literal notranslate"><span class="pre">ipyparallel</span></code>, you need to start an “IPython cluster”.
Do this in the terminal with <code class="docutils literal notranslate"><span class="pre">ipcluster</span> <span class="pre">start</span></code>.</p></li>
<li><p>Then import <code class="docutils literal notranslate"><span class="pre">ipyparallel</span></code> in your notebook, initialize a <code class="docutils literal notranslate"><span class="pre">Client</span></code> instance,
and create <em>DirectView</em> object for direct execution on the engines:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipyparallel</span> <span class="k">as</span> <span class="nn">ipp</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">ipp</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of ipyparallel engines:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">ids</span><span class="p">))</span>
<span class="n">dview</span> <span class="o">=</span> <span class="n">client</span><span class="p">[:]</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>You have now started the parallel engines. To run something simple on
each one of them, try the <code class="docutils literal notranslate"><span class="pre">apply_sync()</span></code> method:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dview</span><span class="o">.</span><span class="n">apply_sync</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="s2">&quot;Hello, World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>A serial evaluation of squares of integers can be seen in the code
snippet below.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serial_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)))</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Convert this to a parallel calculation on the engines using the
<code class="docutils literal notranslate"><span class="pre">map_sync()</span></code> method of the DirectView instance. Time both serial
and parallel versions using <code class="docutils literal notranslate"><span class="pre">%%timeit</span> <span class="pre">-n</span> <span class="pre">1</span></code>.</p></li>
</ul>
<ol class="arabic simple" start="6">
<li><p>You will now parallelize the evaluation of pi using a Monte Carlo
method. First load modules, and export the <code class="docutils literal notranslate"><span class="pre">random</span></code> module to the engines:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>
<span class="n">dview</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span>
</pre></div>
</div>
<p>Then execute the following code in a cell. The function <code class="docutils literal notranslate"><span class="pre">mcpi</span></code> is a Monte
Carlo method to calculate $\pi$. Time the execution of this function using
<code class="docutils literal notranslate"><span class="pre">%timeit</span> <span class="pre">-n</span> <span class="pre">1</span></code> and a sample size of 10 million (<code class="docutils literal notranslate"><span class="pre">int(1e7)</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mcpi</span><span class="p">(</span><span class="n">nsamples</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsamples</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">s</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="mf">4.</span><span class="o">*</span><span class="n">s</span><span class="o">/</span><span class="n">nsamples</span>
</pre></div>
</div>
<p>Now take the incomplete function below which takes a <code class="docutils literal notranslate"><span class="pre">DirectView</span></code> object
and a number of samples, divides the number of samples between the engines,
and calls <code class="docutils literal notranslate"><span class="pre">mcpi()</span></code> with a subset of the samples on each engine. Complete
the function (by replacing the <code class="docutils literal notranslate"><span class="pre">____</span></code> fields), call it with $10^7$ samples,
time it and compare with the serial call to <code class="docutils literal notranslate"><span class="pre">mcpi()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multi_mcpi</span><span class="p">(</span><span class="n">dview</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">):</span>
    <span class="c1"># get total number target engines</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">____</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nsamples</span> <span class="o">%</span> <span class="n">p</span><span class="p">:</span>
        <span class="c1"># ensure even divisibility</span>
        <span class="n">nsamples</span> <span class="o">+=</span> <span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="n">nsamples</span><span class="o">%</span><span class="n">p</span><span class="p">)</span>

    <span class="n">subsamples</span> <span class="o">=</span> <span class="n">____</span><span class="o">//</span><span class="n">p</span>

    <span class="n">ar</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mcpi</span><span class="p">,</span> <span class="n">____</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span><span class="o">/</span><span class="n">____</span>
</pre></div>
</div>
<p>Final note: While parallelizing Python code is often worth it, there
are other ways to get higher performance out of Python code. In
particular, fast numerical packages like <a class="reference external" href="http://www.numpy.org/">Numpy</a>
should be used, and significant speedup can be obtained with just-in-time
compilation with <a class="reference external" href="https://numba.pydata.org/">Numba</a> and/or C-extensions
from <a class="reference external" href="http://cython.org/">Cython</a>.</p>
<div class="admonition-solution solution important dropdown admonition" id="solution-5">
<p class="admonition-title">Solution</p>
<p>Open terminal, run <code class="docutils literal notranslate"><span class="pre">ipcluster</span> <span class="pre">start</span></code> and wait a few seconds for the engines to start.
Import module, create client and DirectView object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipyparallel</span> <span class="k">as</span> <span class="nn">ipp</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">ipp</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">dview</span> <span class="o">=</span> <span class="n">client</span><span class="p">[:]</span>
<span class="n">dview</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">DirectView</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Time the serial evaluation of the squaring lambda function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span>
<span class="n">serial_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)))</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">map_sync</span></code> method of the DirectView instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span>
<span class="n">parallel_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dview</span><span class="o">.</span><span class="n">map_sync</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)))</span>
</pre></div>
</div>
<p>There probably won’t be any speedup due to the communication overhead.</p>
<p>Focus instead on computing pi. Import modules, export <code class="docutils literal notranslate"><span class="pre">random</span></code> module to engines:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>
<span class="n">dview</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mcpi</span><span class="p">(</span><span class="n">nsamples</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsamples</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">s</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="mf">4.</span><span class="o">*</span><span class="n">s</span><span class="o">/</span><span class="n">nsamples</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span>
<span class="n">mcpi</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e7</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>3.05 s ± 97.1 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre></div>
</div>
<p>Function for splitting up the samples and dispatching the chunks to the engines:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multi_mcpi</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nsamples</span> <span class="o">%</span> <span class="n">p</span><span class="p">:</span>
        <span class="c1"># ensure even divisibility</span>
        <span class="n">nsamples</span> <span class="o">+=</span> <span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="n">nsamples</span><span class="o">%</span><span class="n">p</span><span class="p">)</span>

    <span class="n">subsamples</span> <span class="o">=</span> <span class="n">nsamples</span><span class="o">//</span><span class="n">p</span>

    <span class="n">ar</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mcpi</span><span class="p">,</span> <span class="n">subsamples</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span><span class="o">/</span><span class="n">p</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span>
<span class="n">multi_mcpi</span><span class="p">(</span><span class="n">dview</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e7</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1.71 s ± 30.4 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre></div>
</div>
<p>Some speedup is seen!</p>
</div>
</div>
<p><a class="reference external" href="../examples/#exercise-6">In examples.md:</a></p>
<div class="admonition-mixing-python-and-r exercise important admonition" id="exercise-6">
<p class="admonition-title">Mixing Python and R</p>
<p>Your goal now is to define a pandas dataframe, and pass it into an R cell
and plot it with an R plotting library.</p>
<ol class="arabic simple">
<li><p>First you need to install the necessary packages:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!conda install -c r r-essentials
!conda install -y rpy2
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>To run R from the Python kernel we need to load the rpy2 extension:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">rpy2</span><span class="o">.</span><span class="n">ipython</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Run the following code in a code cell and plot it with the basic plot
method of pandas dataframes:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;cups_of_coffee&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
    <span class="s1">&#39;productivity&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Now take the following R code, and use the <code class="docutils literal notranslate"><span class="pre">%%R</span></code> magic command to pass
in and plot the pandas dataframe defined above (to find out how, use
<code class="docutils literal notranslate"><span class="pre">%%R?</span></code>):</p></li>
</ol>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cups_of_coffee</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">productivity</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">geom_line</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Play around with the flags for height, width, units and resolution to get a good looking graph.</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-6">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
 <span class="s1">&#39;cups_of_coffee&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
 <span class="s1">&#39;productivity&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">rpy2</span><span class="o">.</span><span class="n">ipython</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">R</span> <span class="o">-</span><span class="n">i</span> <span class="n">df</span> <span class="o">-</span><span class="n">w</span> <span class="mi">6</span> <span class="o">-</span><span class="n">h</span> <span class="mi">4</span> <span class="o">--</span><span class="n">units</span> <span class="n">cm</span> <span class="o">-</span><span class="n">r</span> <span class="mi">200</span>
<span class="c1"># the first line says &#39;import df and make default figure size 5 by 5 inches</span>
<span class="c1"># with resolution 200. You can change the units to px, cm, etc. as you wish.</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cups_of_coffee</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">productivity</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_line</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="../examples/#exercise-7">In examples.md:</a></p>
<div class="admonition-word-count-analysis-with-widgets exercise important admonition" id="exercise-7">
<p class="admonition-title">Word-count analysis with widgets</p>
<p>This exercise uses the
<a class="reference external" href="https://github.com/coderefinery/word-count">word-count project</a>
from earlier lessons.</p>
<ol class="arabic">
<li><p>Have a look under the <code class="docutils literal notranslate"><span class="pre">data/</span></code> directory. You will see four .dat files
containing word-count statistics from books. You can try opening one.</p></li>
<li><p>Open the Launcher, and open a new Text File.</p></li>
<li><p>Copy-paste the code below to the text file, and save it to a file
<code class="docutils literal notranslate"><span class="pre">zipf.py</span></code> (note how syntax highlighting gets activated).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_word_counts</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a list of (word, count, percentage) tuples from a file where each</span>
<span class="sd">    line is of the form &quot;word count percentage&quot;. Lines starting with # are</span>
<span class="sd">    ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_fd</span><span class="p">:</span>
    	     <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_fd</span><span class="p">:</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
          	   <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">counts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
    <span class="k">return</span> <span class="n">counts</span>

<span class="k">def</span> <span class="nf">top_n_word</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of (word, count, percentage) tuples,</span>
<span class="sd">    return the top n word counts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">limited_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span>
    <span class="n">count_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">count</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">limited_counts</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">count_data</span>

<span class="k">def</span> <span class="nf">zipf_analysis</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">load_word_counts</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
    <span class="n">top_n</span> <span class="o">=</span> <span class="n">top_n_word</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">top_n</span>
</pre></div>
</div>
</li>
<li><p>Import the new zipf module, and have a look at the docstring for one
of the functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import zipf
zipf.top_n_word?
</pre></div>
</div>
</li>
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">zipf_analysis()</span></code> function for a processed datafile. Plot the
output, and compare with a 1/N function, using the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">nmax</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zipf</span><span class="o">.</span><span class="n">zipf_analysis</span><span class="p">(</span><span class="s2">&quot;data/isles.dat&quot;</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">z_norm</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">z</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">z_norm</span><span class="p">)</span>
<span class="n">inv_n</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="o">/</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">inv_n</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add an interactive widget to analyze Zipf’s law, using for example this
code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">nmax</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nd">@interact</span><span class="p">(</span><span class="n">p</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">zipf_plot</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;data/isles.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;data/last.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;data/abyss.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;data/sierra.dat&quot;</span><span class="p">]:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">zipf</span><span class="o">.</span><span class="n">zipf_analysis</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>
        <span class="n">z_norm</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">z</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">z_norm</span><span class="p">)</span>
    <span class="n">inv_n</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="n">p</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">inv_n</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add another widget parameter <code class="docutils literal notranslate"><span class="pre">nmax</span></code> to the above code to control the
number of words displayed on the x-axis, e.g. <code class="docutils literal notranslate"><span class="pre">nmax=(6,14)</span></code>, and play
around with both sliders.</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-7">
<p class="admonition-title">Solution</p>
<p>Code for a widget with sliding bars for both number of words and the inverse power:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="nd">@interact</span><span class="p">(</span><span class="n">nmax</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">14</span><span class="p">),</span> <span class="n">p</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">zipf_plot</span><span class="p">(</span><span class="n">nmax</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="c1">#plt.figure()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;data/isles.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;data/last.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;data/abyss.dat&quot;</span><span class="p">,</span>
              <span class="s2">&quot;data/sierra.dat&quot;</span><span class="p">]:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">zipf</span><span class="o">.</span><span class="n">zipf_analysis</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>
        <span class="n">z_norm</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">z</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">z_norm</span><span class="p">)</span>
    <span class="n">inv_n</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="n">p</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">inv_n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../examples/" class="btn btn-neutral float-left" title="Examples of Jupyter features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../guide/" class="btn btn-neutral float-right" title="Instructor guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright CodeRefinery team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>